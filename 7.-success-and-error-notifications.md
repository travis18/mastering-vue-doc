<link rel="stylesheet" href="assets/style.css" type="text/css" />
# æˆåŠŸèˆ‡å¤±æ•—é€šçŸ¥

åœ¨æˆ‘å€‘ç¯„ä¾‹æ‡‰ç”¨ç¨‹å¼è£¡é¢ï¼Œæœ‰äº›åœ°æ–¹çš„ Vuex ç¨‹å¼ç¢¼ï¼Œåƒæ˜¯å‘¼å« API ç­‰ç­‰æˆ‘å€‘æœ‰å»æ•æ‰éŒ¯èª¤ã€‚ç›®å‰æˆ‘å€‘åªæ˜¯ç°¡å–®çš„æŠŠéŒ¯èª¤è¨Šæ¯ log åˆ° console ä¸Šé¢ã€‚ä½†æ˜¯é€™æ¨£å°ä½¿ç”¨è€…ä¸æ˜¯å¾ˆæœ‰å¹«åŠ©ï¼Œä»–å€‘æ‡‰è©²åœ¨éŒ¯èª¤ç™¼ç”Ÿçš„æ™‚å€™è¢«é€šçŸ¥æ‰è¡Œã€‚

æ‰€ä»¥åœ¨é€™å€‹ç« ç¯€æˆ‘å€‘å°‡å­¸æœƒè¦æ€éº¼åœ¨æˆåŠŸæˆ–å¤±æ•—çš„ Action ç™¼ç”Ÿæ™‚æŠŠé€šçŸ¥åŠ åˆ° Vuex store è£¡ï¼Œå†ä¾†å­¸ç¿’æŠŠé€šçŸ¥é¡¯ç¤ºåœ¨æˆ‘å€‘çš„ UI ä¸Šã€‚

## å•é¡Œï¼šè¨˜éŒ„å’Œé¡¯ç¤ºé€šçŸ¥

App ä¸­çš„åŸ·è¡ŒéŒ¯èª¤å’ŒæˆåŠŸä¹Ÿè¨±æœƒåœ¨å¾ˆå¤šä¸åŒçš„åœ°æ–¹ï¼Œçµ„ä»¶ä»¥åŠ Vuex Action ç™¼ç”Ÿã€‚

æˆ‘å€‘éœ€è¦æœ‰å€‹å¥½æ–¹æ³•ä¾†è¨˜éŒ„å®ƒå€‘å¥½è®“ä»–èƒ½åœ¨æ•´å€‹æ‡‰ç”¨ç¨‹å¼è£¡é¢å…±äº«ã€‚

## è§£æ±ºæ–¹æ¡ˆï¼šä¸€å€‹å°ˆå±¬çš„ Vuex æ¨¡çµ„

å¾ˆåˆç†çš„ï¼ŒVuex åœ¨æˆ‘å€‘éœ€è¦å…±äº« State çš„æ™‚å€™æ˜¯æœ€ä½³è§£æ±ºæ–¹æ¡ˆã€‚å†ä¸Šä¸€å€‹ç« ç¯€ï¼Œæˆ‘å€‘å­¸æœƒäº†å°‡ Vuex ç¨‹å¼ç¢¼å°è£åˆ°æ¨¡çµ„ä¸­ã€‚ä»¥ç¾åœ¨çš„æƒ…æ³æˆ‘å€‘éœ€è¦ä¸€å€‹æ–°çš„ **notification** æ¨¡çµ„ä¾†å„²å­˜ App ä¸­çš„æˆåŠŸå’ŒéŒ¯èª¤é€šçŸ¥ã€‚ç„¶å¾Œå†å°‡é€™äº›é€šçŸ¥é¡¯ç¤ºçµ¦ä½¿ç”¨è€…çœ‹ã€‚

ç¾åœ¨è®“æˆ‘å€‘å…ˆä¾†å»ºç«‹ **notification** æ¨¡çµ„ï¼Œè€Œä¸”è¦ç¢ºèªå®ƒå•Ÿç”¨äº†å‘½åç©ºé–“ã€‚

ğŸ“ƒ **/src/store/modules/notification.js**

```javascript
  export const namespaced = true
  
  export const state = {
    notifications: []
  }
```

è«‹çœ‹ğŸ‘†çš„ç¨‹å¼ç¢¼ï¼Œ`notification` State æ˜¯ä¸€å€‹é™£åˆ—ã€‚è€Œæˆ‘å€‘æƒ³è¦æŠŠé€šçŸ¥åŠ åˆ°é€™å€‹é™£åˆ—è£¡é¢ï¼Œè€Œä¸”æˆ‘å€‘ä¹Ÿæƒ³è¦æœ‰èƒ½å¤ å¾è£¡é¢ç§»é™¤é€šçŸ¥çš„åŠŸèƒ½ã€‚å› æ­¤æˆ‘å€‘æœƒåˆ©ç”¨ Mutation ä¾†å®Œæˆé€™äº›åŠŸèƒ½ã€‚

ğŸ“ƒ **/src/store/modules/notifications.js**

```javascript
  let nextId = 1
  
  export const mutations= {
    PUSH(state, notification){
      state.notification.push({ 
        ...notification, // ä»£è¡¨åŸä¾† notification çš„å±¬æ€§ï¼Œå› ç‚ºè¦åœ¨å‚³å…¥çš„ notification ç‰©ä»¶å¾Œé¢å†åŠ ä¸Šæ–°çš„å±¬æ€§ï¼Œæ‰€ä»¥è¦é€™æ¨£å¯«ã€‚
        id: nextId++ // å†åŠ ä¸Šä¸€å€‹æ–°çš„å±¬æ€§
    })
  },
  DELETE(state, notificationToRemove) {
    state.notifications = state.notifications.filter(
                            notification => notification.id !== notificationToRemove.id
                )
              }
  }
```

ä¸æ„å¤–çš„ï¼Œ`PUSH` Mutation è² è²¬æŠŠè¢«ç•¶ä½œé…¬è¼‰çš„æ–°é€šçŸ¥åŠ å…¥åˆ° `notifications` é™£åˆ—ã€‚è€Œä¸”å†åŠ ä¸Šä¸€å€‹ `id` å±¬æ€§ï¼Œå®ƒçš„å€¼å°±ç”¨è®Šæ•¸ `nextId` çš„å€¼ã€‚é€™æ¨£å¯ä»¥ä¿è­‰æ¯å€‹æ–°çš„é€šçŸ¥éƒ½æœ‰å”¯ä¸€çš„ idï¼Œæˆ‘å€‘å¾Œé¢æœƒç”¨åˆ°å®ƒã€‚

`DELETE` Mutation æ¥å— `messageToRemove` ç‚ºé…¬è¼‰ï¼Œå®ƒæœƒè¢«ç”¨ä¾†ç¯©é¸ `notifications`ï¼Œå¾ State ä¸­ç§»é™¤æŒ‡å®šçš„é€šçŸ¥ã€‚

ğŸ“ƒ **/src/store/modules/notification.js**

```javascript
  ...
  export const actions = {
    add({ commit }, notification) {
      commit('PUSH', notification)
    },
    remove({ commit }, notificationToRemove) {
      commit('DELETE', notificationToRemove)
    }
  }
```

æœ€å¾ŒæŠŠé€™å€‹æ¨¡çµ„åŠ åˆ°æˆ‘å€‘çš„ **store.js** æª”ã€‚

ğŸ“ƒ **/src/store/store.js**

```javascript
  import * as notification from '@/store/modules/notification.js'
  
  export default new Vuex.Store({
    modules: {
      user,
      event,
      notification // <--- æ–°åŠ å…¥çš„æ¨¡çµ„
    }
  }
```

å¾ˆå¥½ï¼ç¾åœ¨ **notification** æ¨¡çµ„æº–å‚™å¥½äº†ï¼

## åŠ å…¥éŒ¯èª¤é€šçŸ¥

ç¾åœ¨ï¼Œæˆ‘å€‘åœ¨ä¸Šå€‹ç« ç¯€å»ºç«‹çš„ **event** æ¨¡çµ„ä¸­ï¼Œæˆ‘å€‘æœ‰å€‹ `fetchEvents` çš„ Actionï¼Œå®ƒæœƒå‘¼å« API ä»¥å¾æˆ‘å€‘çš„æ¨¡æ“¬ä¼ºæœå™¨ä¸Šå–å›æ´»å‹•ã€‚

ğŸ“ƒ **/src/store/modules/event.js**

```javascript
  fetchEvents({ commit, dispatch }, { perPage, page }) {
    
    EventService.getEvents(perPage, page)
      .then( response => {
        commit('SET_EVENTS_TOTAL', parseInt(response.headers['x-total-count']))
        commit('SET_EVENTS', response.data)
        })
        .catch(error => {
          console.log('There was an error:', error.response) // <-- å°±åœ¨é€™é‚Š
        })
      }
  },
```

å¾ğŸ‘†çš„ç¨‹å¼ç¢¼å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæˆ‘å€‘ `catch` åˆ°ä¸€å€‹éŒ¯èª¤ï¼Œæˆ‘å€‘åªæ˜¯æŠŠå®ƒè¨˜éŒ„åˆ° console è€Œå·²ã€‚èˆ‡å…¶å¦‚æ­¤ï¼Œæˆ‘å€‘æƒ³è¦ dispatch æˆ‘å€‘ **notification** æ¨¡çµ„è£¡é¢çš„ `add` Actionï¼Œä¾†æŠŠéŒ¯èª¤åŠ å…¥åˆ° `notifications` State è£¡é¢ã€‚

åŠ å…¥å¾Œçœ‹èµ·ä¾†åƒğŸ‘‡é€™æ¨£ï¼š

```javascript
  ...
    .catch(error => {
      const notification = {
        type: 'error',
        message: 'There was a problem fetching events: ' + error.message
        }
        dispatch('notification/add', notification, { root: true })
      })
```

åœ¨ğŸ‘†çš„ç¨‹å¼ç¢¼ï¼Œæˆ‘å€‘å»ºç«‹äº†ä¸€å€‹ `notification` ç‰©ä»¶ï¼Œå®ƒçš„ `type` å±¬æ€§æ˜¯ `'error'` é‚„æœ‰ä¸€å€‹ `message` å±¬æ€§æè¿°éŒ¯èª¤è¨Šæ¯ã€‚

æ¥è‘—æˆ‘å€‘æŠŠ `notification` ç‰©ä»¶ç•¶ä½œé…¬è¼‰å‚³é€² Actionã€‚å› ç‚º `notification` æ¨¡çµ„å·²ç¶“å•Ÿç”¨å‘½åç©ºé–“ï¼Œæˆ‘å€‘å°±å¯ä»¥ä»¥ `notification/add` ä¾† dispatch `add` Actionã€‚

ç¬¬ä¸‰å€‹å¼•æ•¸ï¼Œ`{ root: true }` å¾ˆé‡è¦ã€‚é€™å‘Šè¨´ `dispatch` åœ¨ æ ¹ store å»æ‰¾ `notification/add` é€™å€‹ Actionï¼Œè€Œä¸æ˜¯åªåœ¨ç›®å‰çš„æ¨¡çµ„å»æ‰¾ã€‚

## æª¢é©—é€šçŸ¥æ¨¡çµ„

å› ç‚º `fetchEvents` Action åœ¨ **EventList** é é¢è¢« dispacth çš„ï¼Œæˆ‘å€‘å¯ä»¥è©¦è©¦çœ‹åœ¨ json-server é—œæ‰çš„æƒ…å½¢ä¸‹ç€è¦½é€™å€‹é é¢ã€‚æ²’æœ‰äº†æ¨¡æ“¬ä¼ºæœå™¨ API å‘¼å«å°±æœƒå¤±æ•—ï¼Œç„¶å¾ŒéŒ¯èª¤é€šçŸ¥å°±æœƒè¢«åŠ å…¥åˆ° Vuex Stateã€‚

å¦‚æœæˆ‘å€‘æª¢æŸ¥ä¸€ä¸‹ DevTools çš„ Vuex tabï¼Œå°±å¯ä»¥çœ‹åˆ°éŒ¯èª¤åŠ åˆ° `notifications` State è£¡ã€‚ğŸ‘ï¼

![](assets/Ch07/01.png)

## æ›´å¤šçš„éŒ¯èª¤é€šçŸ¥

é‚„æœ‰ä¸€äº›åœ°æ–¹å¯èƒ½æœƒç™¼ç”ŸéŒ¯èª¤ï¼Œæˆ‘å€‘ä¹Ÿæƒ³è¦åœ¨é‚£è£¡é¢åŠ å…¥ `add` Actionã€‚

å†å›åˆ° **event** æ¨¡çµ„ï¼Œæˆ‘å€‘é‚„æœ‰ä¸€å€‹ `fetchEvent` çš„ Action åªæ˜¯æŠŠéŒ¯èª¤è¨˜éŒ„åˆ° console ä¸Šã€‚

ğŸ“ƒ **/src/store/modules/event.js**

```javascript
  fetchEvent({ commit, getters, dispatch }, id) {
    var event = getters.getEventById(id)
    if (event) {
      commit('SET_EVENT', event)
    } else {
      EventService.getEvent(id)
        .then(response => {
          commit('SET_EVENT', response.data)
        })
        .catch(error => {
          console.log('There was an error:', error.response) // <-- å°±åœ¨é€™é‚Š
        })
    }
  }
```

ç„¶å¾Œä¿®æ”¹æ•æ‰éŒ¯èª¤è™•ç†é‚£æ®µç¨‹å¼ç¢¼ã€‚

ğŸ“ƒ **/src/store/modules/event.js**

```javascript
  ...
    .catch(error => {
      const notification = {
        type: 'error',
        message: 'There was a problem fetching an event: ' + error.message
      }
      dispatch('notification/add',notification,{ root: true })
    })
  ...
```

é€™æ¨£ä¸€ä¾† app å˜—è©¦ `fetEvents` æˆ– `fetEvent` è€Œç”¢ç”Ÿçš„éŒ¯èª¤å°±æœƒè¢«åŠ å…¥åˆ° **notification** æ¨¡çµ„è£¡äº†ã€‚

## æˆåŠŸå’ŒéŒ¯èª¤é€šçŸ¥

ç¾åœ¨é‚„æœ‰ä¸€å€‹åœ°æ–¹è¦åŠ å…¥é€šçŸ¥ç¨‹å¼ç¢¼ã€‚è·Ÿå‰é¢çš„å·®åˆ¥æ˜¯ï¼Œé™¤äº†éŒ¯èª¤æˆ‘å€‘é‚„è¦åŠ å…¥æˆåŠŸé€šçŸ¥ã€‚

å†æ‰“é–‹ **event** æ¨¡çµ„ï¼Œè·³åˆ°è£¡é¢çš„ `createEvent` Actionã€‚

ğŸ“ƒ **/src/store/modules/event.js**

```javascript
  createEvent({ commit }, event) {
    return EventService.posEvent(event).then(() => {
      commit('ADD_EVENT', event)
    })
  }
```

æˆ‘å€‘å¯ä»¥åœ¨æ´»å‹•è¢«åŠ å…¥åˆ°æ¨¡æ“¬è³‡æ–™åº«çš„æ™‚å€™ä¹ŸåŠ å…¥æˆåŠŸé€šçŸ¥é“ **notification** æ¨¡çµ„ã€‚

ğŸ“ƒ **/src/store/modules/event.js**

```javascript
  createEvent({ commit, dispatch }, event) {
    return EventService.postEvent(event)
      .then(() => {
        commit('ADD_EVENT', event)
        const notification = {
          type: 'success',
          message: 'Your event has been created!'
        }
        dispatch('notification/add', notification, { root: true })
      })
  }
```

ğŸ‘†é€™æ®µç¨‹å¼ç¢¼çœ‹èµ·ä¾†ååˆ†çš„ç†Ÿæ‚‰ã€‚ç‰¹åˆ¥æ˜¯åœ¨å»ºç«‹å’Œå‘¼å« `notification` ç‰©ä»¶é‚£æ®µã€‚åªæ˜¯å‘¼å«çš„æ™‚æ©Ÿå’ŒéŒ¯èª¤é€šçŸ¥ä¸åŒã€‚

æ¥è‘—æˆ‘å€‘å†ä¾†åŠ å…¥ `catch` éƒ¨åˆ†çš„é€šçŸ¥ã€‚

ğŸ“ƒ **/src/store/modules/event.js**

```javascript
  ...
        dispatch('notification/add', notification, { root: true })
      })
      .catch(error => {
        const notification = {
          type: 'error',
          message: 'There was a problem creating your event: ' + error.message
        }
        dispatch('notification/add', notification, { root: true })
        throw error
      })
    }
```

åŒæ¨£çš„æˆ‘å€‘å†ä¸€æ¬¡å»ºç«‹äº†æ–°çš„ `notification` ç‰©ä»¶ç„¶å¾ŒæŠŠå®ƒç•¶ä½œé…¬è¼‰ dispatch åˆ° `add` Actionã€‚

æˆ‘å€‘é‚„éœ€è¦æŠŠ`éŒ¯èª¤(error)`å¾€ä¸Š`ä¸Ÿ(throw)`ï¼Œè—‰æ­¤æŠŠéŒ¯èª¤å‚³åˆ°çµ„ä»¶å»ã€‚è®“æˆ‘å€‘å›é ­ä¾†çœ‹çœ‹ **EventCreate** çµ„ä»¶ï¼Œå¦‚æœ `error` è¢«æŠ“åˆ°çš„è©±ï¼Œæˆ‘å€‘ä¸æœƒæŠŠè·¯ç”± `$route.push` å‡ºå»ï¼Œä¹Ÿä¸æœƒæ¸…é™¤ `this.event` çš„å…§å®¹ã€‚

æˆ‘å€‘å¯ä»¥é †ä¾¿æŠŠçµ„ä»¶ä¸Šé¢æ•æ‰åˆ°éŒ¯èª¤ç„¶å¾ŒæŠŠéŒ¯èª¤è¨˜éŒ„åˆ° console çš„ç¨‹å¼ç¢¼éƒ½æ‹¿æ‰ã€‚

```javascript
  createEvent() {
    this.$store.dispatch('event/createEvent', this.event).then(() => {
      this.$router.push({
        name: 'event-show',
        params: { id: this.event.id }
      })
      this.event = this.createFreshEventObject()
    })
    .catch(() => { // <-- åˆªé™¤
      console.log('There was a problem creating your event') // <-- åˆªé™¤
    }) // <-- åˆªé™¤
  }
```

## é¡¯ç¤ºé€šçŸ¥

æˆ‘å€‘ä»¥åŠè·Ÿç‚º Vuex ç¨‹å¼ç¢¼æ–°å¢äº†åŠ å…¥å’Œå­˜æ”¾é€šçŸ¥çš„èƒ½åŠ›ï¼Œ æ¥ä¸‹ä¾†å°±æ˜¯è¦åšåœ¨ app ä¸­é¡¯ç¤ºé€šçŸ¥çš„åŠŸèƒ½äº†ã€‚æˆ‘å€‘æœƒé€éå»ºç«‹å¹¾å€‹çµ„ä»¶ä¾†å®Œæˆé€™å€‹åŠŸèƒ½ã€‚

1. **NotificationBar.vue**ï¼šæœƒç”¨ä¾†é¡¯ç¤ºé€šçŸ¥è¨Šæ¯ã€‚
2. **NotificationContainer.vue**ï¼šæœƒç‚ºæ¯å€‹åœ¨ State çš„é€šçŸ¥å»ºç«‹ä¸€å€‹ **NotificationBar**ã€‚

å…ˆå¾ **NotificationBar** é–‹å§‹å”„ï½

ğŸ“ƒ **/src/components/NotificationBar.vue

```javascript
  <template>
    <div class="notification-bar">
      <p>{{ notification.message }}</p>
    </div>
  </template>
  
  <script>
    export default {
      props: {
        notification: {
          type: Object,
          required: true
        }
      }
    }
  </script>
  
  <style scoped>
    .notification-bar {
      margin: 1em 0 1em;
    }
  </style>
```

ğŸ‘†çš„ç¨‹å¼ç¢¼ï¼Œæˆ‘å€‘æŠŠ `notification.message` æ”¾åœ¨ `p` æ¨™ç±¤è£¡ï¼Œé€™å€‹çµ„ä»¶æœ¬èº«æœƒæ¥æ”¶ä¸€å€‹ **notification** ç‰©ä»¶ç•¶ä½œæ˜¯ `prop` å±¬æ€§ã€‚

ç‚ºäº†è¦æŠŠæˆåŠŸå’Œå¤±æ•—é€šçŸ¥çš„æ¨£å¼åšå€‹å€åˆ¥ï¼Œæˆ‘éº¼åŠ å…¥äº†ä¸€å€‹åˆ©ç”¨ `notification` ç‰©ä»¶ä¸­ `type` å±¬æ€§çš„ `computed` å±¬æ€§ä¾†å»ºç«‹ è¦ä½¿ç”¨çš„ `class` åç¨±ã€‚

```javascript
  ...
    computed: {
      notificationTypeClass() {
        return '-text-${this.notification.type}'
      }
    }
```

é€™å€‹å±¬æ€§æœƒåŸºæ–¼ `notification` ç‰©ä»¶çš„ `type` å±¬æ€§å›å‚³ '-text-success' æˆ– '-text-error'ï¼Œé€™å€‹ css class æœƒæŠŠé€šçŸ¥ä¾é¡å‹æŠŠé€šçŸ¥çš„æ¨£å¼è¨­ç‚ºé»‘è‰²æˆ–ç´…è‰²ã€‚

å†ä¾†æˆ‘å€‘åªéœ€è¦ç”¨ v-bind æŠŠ css class ç¶å®šåˆ° div æ¨™ç±¤ã€‚

```javascript
  <div class="notification-bar"
        :class="notificaitonTypeClass"> <-- ç¶å®š computed å±¬æ€§
    <p>{{ notification.message }}</p>
  </div>
```

## å †é€² NotificationContainer

è¼ªåˆ°å»ºç«‹æˆ‘å€‘çš„ **NotificationContainer** çµ„ä»¶äº†ï¼Œç„¶å¾Œç”¨å®ƒä¾†å»ºç«‹æˆ‘å€‘çš„ **NotificationBar** çµ„ä»¶ã€‚

ğŸ“ƒ **/src/components/NotificationContainer.vue**

```javascript
  <template>
    <div class="notification-container">
      <NotificationBar
        v-far="notification in notifications"
        :key="notification.id"
        :notification="notification"
      />
    </div>
  </template>
  
  <script>
    import NotificationBar from './NotificationBar'
    import { mapState } from 'vuex'
    
    export default {
      components: { NotificationBar },
      computed: mapState('notification',['notifications'])
    }
  </script>
  
  <style scoped>
    .notification-container {
      position: fixed;
      bottom: 0;
    }
  </style>
```

å¾ğŸ‘†çš„ç¨‹å¼ç¢¼ä¾†çœ‹ï¼Œæˆ‘å€‘åŒ¯å…¥äº† **NotificationBar** å’Œ **mapState**ã€‚æ¥è‘—åˆ©ç”¨ `v-for` ç‚º **notification** state è£¡æ¯å€‹ `notifications` å»ºç«‹ **NotificationBar**ï¼Œæˆ‘å€‘æŠŠ `notifications` æ˜ å°„åˆ° `computed` å±¬æ€§ã€‚

æ³¨æ„ä¸€ä¸‹æˆ‘å€‘æ˜¯æ€éº¼åœ¨ **NotificationBar** å»ºç«‹æ™‚æŠŠæ¯ä¸€å€‹ `notification` é¤µé€²å» `prop` è£¡é¢ï¼Œç„¶å¾Œåˆ©ç”¨ `notification.id` ç‚ºæ¯å€‹çµ„ä»¶å»ºç«‹å”¯ä¸€éµå€¼ã€‚

æ¥ä¸‹ä¾†æˆ‘å€‘åªéœ€è¦ç‚º **NotificationContainer** æ‰¾å€‹åœ°æ–¹é¡¯ç¤ºå³å¯ã€‚

## æŠŠ NotificationContainer åŠ åˆ° APP.js

å› ç‚ºæˆ‘å€‘æƒ³è¦è®“é€šçŸ¥åœ¨å…¨éƒ¨çš„åœ°æ–¹éƒ½çœ‹å¾—åˆ°ï¼Œä»¥ app å±¤ç´šä¾†çœ‹ï¼Œæˆ‘å€‘æ‰“ç®—æŠŠ **NotificationContainer** çµ„ä»¶åŒ¯å…¥åˆ° app æœ€åº•å±¤çš„çµ„ä»¶ï¼š**App.vue**ã€‚ç„¶å¾ŒæŠŠå®ƒæ”¾åˆ° App çš„æ¨£æ¿è£¡é¢ï¼ŒåƒğŸ‘‡é€™æ¨£ï¼š

ğŸ“ƒ **/src/App.vue**

```javascript
  <template>
    <div id="app">
      <NavBar />
      <NotificationContainer />
      <router-view :key="$router.fullPath" />
    </div>
  </template>
  
  <script>
    import NavBar from '@/components/NavBar.vue'
    import NotificationContainer from '@/components/NotificationContainer.vue'
    
    export default {
      components: {
        NavBar,
        NotificationContainer
      }
    }
  </script>
```

## ç§»é™¤é€šçŸ¥

å¾å‰é¢çš„å…§å®¹è£¡ï¼Œæˆ‘å€‘å·²ç¶“åœ¨ **notification** æ¨¡çµ„è£¡é¢åŠ å…¥äº† `remove` çš„åŠŸèƒ½ã€‚æ‰€ä»¥æˆ‘å€‘ä»€éº¼æ™‚å€™æƒ³è¦ä½¿ç”¨å®ƒå‘¢ï¼Ÿå…¶ä¸­ä¸€å€‹æœƒç”¨åˆ°å®ƒçš„æ–¹å¼æ˜¯ï¼Œæˆ‘å€‘ç‚ºå·²ç¶“é¡¯ç¤ºçš„é€šçŸ¥è¨­å®šç¶“éä¸€å®šçš„æ™‚é–“ï¼Œæ¯”å¦‚èªª 5 ç§’é˜ã€‚åœ¨ 5 ç§’é˜æ™‚é–“åˆ°çš„æ™‚å€™ï¼Œé€šçŸ¥æœƒæŠŠè‡ªå·±çµ¦ç§»é™¤ã€‚

ä¾†çœ‹çœ‹è¦æ€éº¼åšåˆ°ã€‚æˆ‘å€‘å¯ä»¥å…ˆä¾†åˆ©ç”¨ `mapActions` ç‚º **NotificationBar** çµ„ä»¶åŠ å…¥èƒ½ dispatch `remove` Action çš„èƒ½åŠ›ã€‚

ğŸ“ƒ **/src/components/NotificationBar.vue**

```javascript
  iomport { mapActions } from 'vuex'
  ...
    props: {
      notification: {
        type: Object,
        required: true
      }
    },
    methods: mapActions('notification',['remove'])
    ...
```

ç•¶æˆ‘å€‘åœ¨ dispatch é€™å€‹ Action çš„æ™‚å€™ï¼Œç¨‹å¼ç¢¼çœ‹èµ·ä¾†æœƒåƒæ˜¯ğŸ‘‡é€™æ¨£ï¼š
`this.remove(this.notification)`ã€‚æˆ‘å€‘å‚³å…¥`notification`å±¬æ€§ç•¶ä½œæ˜¯é…¬è¼‰ã€‚

é‚£ä»€éº¼æ™‚å€™è¦è§¸ç™¼ `this.remove(this.notification)` å‘¢ï¼Ÿå’Œå‰é¢èªªçš„ä¸€æ¨£ï¼Œå¯ä»¥åœ¨é¡¯ç¤ºå¾Œ 5 ç§’å¾Œè§¸ç™¼ã€‚æ›å¥è©±èªªï¼Œä¹Ÿå°±æ˜¯åœ¨ **NotificationBar** çµ„ä»¶ mount åˆ° DOM ä¹‹å¾Œç¶“é 5 ç§’è§¸ç™¼ã€‚ä¹Ÿå› ç‚ºé€™æ¨£æˆ‘å€‘å¯ä»¥æŠŠå®ƒæ”¾åˆ° `mounted` çš„ç”Ÿå‘½é€±æœŸé‰¤å­(hook)

ğŸ“ƒ **/src/components/NotificationBar.vue**

```javascript
  ...
    data() {
      return {
        timeout: null
      }
    },
    mounted() {
      this.timeout = setTimeout(() => this.remove(this.notification), 5000)
    },
    methods: mapActions('notification', ['remove'])
```

åœ¨ğŸ‘†çš„ç¨‹å¼ç¢¼è£¡é¢æˆ‘å€‘åœ¨ `data` å±¬æ€§åŠ å…¥äº† `timeout` ç‰©ä»¶ï¼Œç„¶å¾Œè¨­å®šåˆ° `setTimeout` å‡½å¼ä¸­ï¼Œé€™å€‹å‡½å¼æœƒåœ¨ `mounted` å¾Œç­‰å¾… 5 ç§’ï¼ˆ5000æ¯«ç§’ï¼‰ç„¶å¾Œ dispatch `remove` Actionã€‚æ›å¥è©±èªªï¼Œç•¶é€™å€‹çµ„ä»¶è¢« `mounted` ä¹‹å¾Œï¼Œå°±è¡¨ç¤ºé€šçŸ¥å·²ç¶“é¡¯ç¤ºåœ¨ç•«é¢ä¸Šäº†ï¼Œè€Œåœ¨å€’æ•¸ 5 ç§’å¾Œå†æŠŠé€™å€‹é€šçŸ¥çµ¦åˆªæ‰ã€‚

ä½†æˆ‘å€‘ç‚ºä½•è¦æŠŠ `timeout` æ”¾åœ¨ `data` è£¡é¢å‘¢ï¼Ÿæˆ‘å€‘ä¸èƒ½ç›´æ¥åœ¨ `mounted` è£¡é¢å‘¼å«å—ï¼Ÿæˆ‘å€‘è¦é€™éº¼åšçš„åŸå› æ˜¯å› ç‚ºè¦ç¢ºä¿åœ¨çµ„ä»¶è¢«æ‘§æ¯€å‰è¦æ¸…é™¤ `setTimeout`ï¼ŒåƒğŸ‘‡é€™æ¨£ï¼š

ğŸ“ƒ **/src/components/NotificationBar.vue**

```javascript
  ...
    beforeDestroy() {
      clearTimeout(this.timeout)
    },
  ...
```

è—‰ç”±è®“çµ„ä»¶åœ¨æ²’æœ‰è¢«é¡¯ç¤ºçš„æ™‚å€™ä¸è®“ `setTimeout` ç¹¼çºŒåŸ·è¡Œå¯ä»¥é¿å…[è¨˜æ†¶é«”æ´©æ¼](https://medium.com/outsystems-experts/beyond-memory-leaks-in-javascript-d27fd48ae67e)ã€‚