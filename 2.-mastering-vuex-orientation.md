<link rel="stylesheet" href="assets/style.css" type="text/css" />
## é‚å‘ Vuex å¤§å¸«ä¹‹è·¯

åœ¨é€™å€‹ç« ç¯€ä¸­æœƒç‚ºå¤§å®¶ä»‹ç´¹ç¯„é€™å€‹èª²ç¨‹æ‰€ç”¨çš„ç¯„ä¾‹æ‡‰ç”¨ç¨‹å¼ã€‚

åœ¨å­¸ç¿’é€™é–€æ•™å­¸çš„å…ˆå‚™çŸ¥è­˜æœ‰ï¼š

- Vue CLI
- Vue Router
- å–®ä¸€çš„ .vue çµ„ä»¶æª”
- ä»¥ Axios å‘¼å« API

---------------

## ä¸‹è¼‰ç¯„ä¾‹

ç¯„ä¾‹æ‡‰ç”¨ç¨‹å¼å¯ä»¥å¾ [github](https://github.com/Code-Pop/real-world-vue/releases/tag/lesson11-vuex-start) ä¸‹è¼‰ï¼Œè«‹å…ˆä¸‹è¼‰åˆ°ä½ çš„é›»è…¦ä¸Šã€‚

## å•Ÿå‹•ä¸¦åŸ·è¡Œæ‡‰ç”¨ç¨‹å¼

å¦‚æœæ˜¯å¾çµ‚ç«¯æ©Ÿä»‹é¢ç€è¦½å°ˆæ¡ˆè³‡æ–™å¤¾ï¼Œæˆ‘å€‘å¯ä»¥åŸ·è¡Œ `npm install` æŒ‡ä»¤å…ˆå®‰è£å¥½å°ˆæ¡ˆçš„ç›¸ä¾å‡½å¼åº«ã€‚

å› ç‚ºæˆ‘å€‘çš„æ‡‰ç”¨ç¨‹å¼æœƒå‘¼å« APIï¼Œæ‰€ä»¥æˆ‘å€‘æœƒç”¨åˆ° [json-server](https://github.com/typicode/json-server) é€™å€‹å·¥å…·ã€‚å®ƒæ˜¯ä¸€å€‹æ¨¡æ“¬çš„ REST API ä¼ºæœå™¨ï¼Œæˆ‘å€‘å¯ä»¥ç”¨å®ƒä¾†å¾æ¨¡æ“¬çš„è³‡æ–™åº«(*é›–èªªæ˜¯è³‡æ–™åº«ï¼Œä½†ä¸éå°±æ˜¯ä¸€å€‹ json æª”æ¡ˆ*)ä¸­å‘¼å« REST APIã€‚å¦‚æœé‚„æ²’å®‰è£é€™å€‹å·¥å…·ï¼Œå¯ä»¥åœ¨çµ‚ç«¯æ©Ÿè¼¸å…¥ `npm install -g json-server` ä¾†å®‰è£å®ƒã€‚å®‰è£å¥½ä¹‹å¾Œå†åŸ·è¡Œï¼š`json-server --watch db.json`ï¼Œä¾¿æœƒå•Ÿå‹•ä¼ºæœå™¨ä»¥åŠ*ç›£è¦–*æˆ‘å€‘æ‰€æŒ‡å®šçš„ db.json æª”æ¡ˆä¾†æ¨¡æ“¬è³‡æ–™åº«ã€‚

ç¾åœ¨æˆ‘å€‘ä¾†è©¦è©¦çœ‹æŠŠæ‡‰ç”¨ç¨‹å¼å«èµ·ä¾†ï¼ŒåŸ·è¡Œé€™å€‹æŒ‡ä»¤ `npm run serve` çœ‹çœ‹ï¼ŒåŸ·è¡Œå®Œç•¢å¾Œä¼ºæœå™¨æœƒè®“æˆ‘å€‘çŸ¥é“å®ƒåœ¨å“ªå€‹ port ä¸Šé¢è·‘ã€‚

-----------------

## åœ¨ç€è¦½å™¨ä¸ŠåŸ·è¡Œæ‡‰ç”¨ç¨‹å¼

ç•¶ä¼ºæœå™¨å•Ÿå‹•æˆåŠŸå¾Œï¼Œæ‰“é–‹ç€è¦½å™¨åœ¨ä½å€åˆ—è¼¸å…¥ localhost:port æˆ‘å€‘å°±å¯ä»¥çœ‹åˆ°æ‡‰ç”¨ç¨‹å¼ã€‚

åœ¨ä¸»é ï¼Œæˆ‘å€‘æœƒé¡¯ç¤ºå¾ API å‘¼å«æŠ“å›ä¾†çš„ event æ´»å‹•åˆ—è¡¨ã€‚ç•¶æŒ‰ä¸‹å…¶ä¸­ä¸€å€‹æ´»å‹•æ™‚ï¼Œæœƒé€£åˆ° `event-show` é é¢ï¼Œè£¡é¢æœƒé¡¯ç¤ºæ´»å‹•çš„è©³ç´°è³‡è¨Šã€‚æˆ‘å€‘åˆ©ç”¨ Vue Router ä¾†é”æˆç¶²ç«™å°è¦½çš„åŠŸèƒ½ï¼Œè®“æˆ‘å€‘å¯ä»¥åœ¨ä¸åŒé é¢ä¸­åˆ‡æ›ã€‚

ç¾åœ¨å†è®“æˆ‘å€‘çœ‹çœ‹å°ˆæ¡ˆçš„å…§å®¹ã€‚

## App å°è¦½

å› ç‚ºä½¿ç”¨ç‡ Vue CLI ä¾†å»ºç«‹ appï¼Œæ‰€ä»¥å¾—åˆ°äº†ä»¥ä¸‹çš„è³‡æ–™å¤¾çµæ§‹ã€‚

![](assets/Ch02/01.png)

åœ¨ **views** è³‡æ–™å¤¾è£¡é¢æœ‰3å€‹çµ„ä»¶ï¼Œæœƒåœ¨æˆ‘å€‘ç€è¦½åˆ°ä½¿ç”¨å®ƒå€‘çš„é é¢æ™‚è¢«è¼‰å…¥ã€‚

ç›®å‰ **EventCreate** çµ„ä»¶è£¡é¢åªæ˜¯ä¸€å€‹ç°¡å–®çš„æ¨£æ¿ã€‚

ğŸ“ƒ **/src/views/EventCreate.vue**

```javascript
    <template>
      <h1>Create Event</h1>
    </template>
```

**EventList** çµ„ä»¶çš„å…§å®¹ï¼š

```javascript
    <script>
    import EventCard from '@/components/EventCard.vue'
    import EventService from '@/services/EventService.js'
    
    export default {
      components: {
        EventCard
      },
      data() {
        return {
          events: []
        }
      },
      created() {
        EventService.getEvents()
          .then(response => {
            this.events = response.data
          })
          .catch(error => {
            console.log('There was an error:', error.response)
          })
      }
    }
    </script>
```

ç•¶é€™å€‹çµ„ä»¶è¢«å»ºç«‹çš„æ™‚å€™ï¼Œæˆ‘å€‘æœƒå‘¼å« API `EventService.getEvents()` ä¾†å–å¾—æ´»å‹•è³‡æ–™ã€‚ç„¶å¾Œæˆ‘å€‘æœƒå°‡çµ„ä»¶çš„ `enents` è³‡æ–™å¸¶å…¥ response çš„çµæœã€‚è€Œä¸”æˆ‘å€‘ä¹Ÿæœƒæ•æ‰éŒ¯èª¤ï¼Œå¦‚æœå‘¼å« API æœ‰éŒ¯èª¤å°±æœƒåœ¨ console ä¸Šé¢è¼¸å‡ºéŒ¯èª¤å…§å®¹ã€‚

ğŸ“ƒ **/src/views/EventList.vue**

```javascript
    <template>
      <div>
        <h1>Events Listing</h1>
        <EventCard v-for="event in events" :key="event.id" :event="event"/>
      </div>
    </template>
```

åœ¨é€™å€‹æ¨£æ¿è£¡é¢ï¼Œæˆ‘å€‘ä½¿ç”¨äº† `v-for` ä¾†ç‚ºæ‰€æœ‰çš„ `events` å»ºç«‹ **EventCard** çµ„ä»¶ï¼Œç„¶å¾ŒæŠŠé™£åˆ—è£¡é¢çš„ `event` ç•¶ä½œåƒæ•¸å‚³çµ¦ **EventCard**ã€‚

æ¥è‘—è®“æˆ‘å€‘ä¾†çœ‹çœ‹ä½æ–¼ **components** è³‡æ–™å¤¾è£¡é¢çš„ **EventCard** çµ„ä»¶ã€‚

ğŸ“ƒ **/src/components/EventCard.vue**

```javascript
    <template>
      <router-link class="event-link" :to="{ name: 'event-show', params: { id: event.id } }">
        <div class="event-card -shadow">
          <span class="eyebrow">@{{ event.time }} on {{ event.date }}</span>
          <h4 class="title">{{ event.title }}</h4>
          <BaseIcon name="users">{{ event.attendees.length }} attending</BaseIcon>
        </div>
      </router-link>
    </template>
    
    <script>
    export default {
      props: {
        event: Object
      }
    }
    </script>
    
    <style scoped>
    ...
    </style>

```

å®ƒæœƒæ¥æ”¶ `event` ç‰©ä»¶ç•¶ä½œåƒæ•¸(`prop`)ï¼Œç„¶å¾Œåœ¨æ¨£æ¿ä¸­é¡¯ç¤ºäº‹ä»¶çš„éƒ¨åˆ†è³‡æ–™ã€‚

è«‹é †ä¾¿æ³¨æ„ä¸€ä¸‹å®ƒæ™‚æ€éº¼åˆ©ç”¨ **BaseIcon** é€™å€‹çµ„ä»¶ã€‚

ğŸ“ƒ **/src/components/BaseIcon.vue**

```javascript
    <template>
        <div class="icon-wrapper">
          <svg class='icon' :width="width" :height="height">
            <use v-bind="{'xlink:href':'/feather-sprite.svg#' + name}"/>
          </svg>
          <slot></slot>
        </div>
    </template>
        
    <script>
    export default {
      name: 'Icon',
      props: {
        name: String,
        width: {
          type: [Number, String],
          default: 24
        },
        height: {
          type: [Number, String],
          default: 24
        }
      }
    }
    </script>
        
    <style scoped>
    ...
    </style>
```

é€™æ˜¯ä¸€å€‹æ¥å— `name`ï¼Œ`width` ä»¥åŠ `height` å±¬æ€§ä¸¦ä¸”å¸¶æœ‰ä¸€å€‹ svg åœ–ç¤ºçš„çµ„ä»¶ã€‚å®ƒä½¿ç”¨äº† **feather-sprite.svg**(æª”æ¡ˆä½æ–¼**public**è³‡æ–™å¤¾)åœ–ç¤ºåº«ã€‚

## äº†è§£ API å‘¼å«

è®“æˆ‘å€‘ä¾†æ›´é€²ä¸€æ­¥çœ‹çœ‹ **EventList** ä¸­çš„ API å‘¼å«ã€‚

ğŸ“ƒ **/src/views/EventList.vue**

```javascript
    import EventService from '@/services/EventService.js'
    ...
      created() {
        EventService.getEvents()
          .then(response => {
            this.events = response.data
          })
          .catch(error => {
            console.log('There was an error:', error.response)
          })
      }
    ...
```

é€™é‚Šè«‹æ³¨æ„æˆ‘å€‘æ€éº¼åˆ©ç”¨ `EventService` ä¾†å‘¼å« `getEvents` æ–¹æ³•çš„ã€‚æˆ‘å€‘é€éå¾ **services** è³‡æ–™å¤¾ `import` æª”æ¡ˆã€‚ç¾åœ¨æˆ‘å€‘æ¥è‘—ä¾†çœ‹çœ‹é‚£å€‹æª”æ¡ˆã€‚

ğŸ“ƒ **/src/services/EventService.js**

```javascript
    import axios from 'axios'
    
    const apiClient = axios.create({
      baseURL: `http://localhost:3000`,
      withCredentials: false, // This is the default
      headers: {
        Accept: 'application/json',
        'Content-Type': 'application/json'
      }
    })
    
    export default {
      getEvents() {
        return apiClient.get('/events')
      },
      getEvent(id) {
        return apiClient.get('/events/' + id)
      }
    }
```

åœ¨é€™å€‹æª”æ¡ˆè£¡ï¼Œæˆ‘å€‘ `import` äº† Axios å‡½å¼åº«ã€‚å¦‚æœé‚„æ²’å®‰è£çš„è©±ï¼Œå¯ä»¥åœ¨çµ‚ç«¯æ©Ÿè£¡åŸ·è¡Œï¼š`npm install axios` æŒ‡ä»¤ä¾†å®‰è£ã€‚

æ¥è‘—åœ¨ç¨‹å¼ç¢¼ä¸­ï¼Œæˆ‘å€‘å»ºç«‹äº†åç‚º `apiClient` çš„å–®ä¸€ Axios å¯¦é«”ã€‚åœ¨å»ºç«‹çš„æ™‚å€™ä¾¿çµ¦å®ƒ `baseURL` å’Œè¨­å®šä¸€äº›é è¨­çš„çµ„æ…‹ã€‚

ä¹‹å‰æåˆ°ä½¿ç”¨çš„ json-server æœƒä½¿ç”¨ **db.json** æª”æ¡ˆä¾†æ¨¡æ“¬æˆ‘å€‘åŒ…å«æ´»å‹•è³‡æ–™çš„ "è³‡æ–™åº«"ï¼Œå› æ­¤åœ¨æˆ‘å€‘è¨ªå• `localhost:3000/events` çš„æ™‚å€™ï¼Œæˆ‘å€‘å¯ä»¥çœ‹åˆ° **db.json** æª”ä¸­æ‰€æœ‰çš„æ´»å‹•ã€‚è€Œå› ç‚º json-server æ˜¯ä¸€å€‹æ¨¡æ“¬çš„ REST APIï¼Œæˆ‘å€‘å¯ä»¥é€éå®ƒä¾† GET æ´»å‹•å’Œ POST æ–°æ´»å‹•åˆ° **db.json** ä¸­ï¼Œç­‰è«¸å¦‚æ­¤é¡çš„ REST åŠŸèƒ½ã€‚

åœ¨æª”æ¡ˆçš„åº•éƒ¨ï¼Œæˆ‘å€‘ `export` å¹¾å€‹ä½¿ç”¨ `apiClient` å–å¾—æ‰€æœ‰æ´»å‹•æˆ–åªå–å¾—æŸå€‹æŒ‡å®šæ´»å‹•(å‚³å…¥ id ç•¶åƒæ•¸)çš„æ–¹æ³•ã€‚åœ¨å‰é¢æˆ‘å€‘å·²ç¶“çœ‹é **EventList** çµ„ä»¶æ˜¯æ€éº¼åœ¨å®ƒçš„ `created` é‰¤å­(hook)å‘¼å« `getEvents` æ–¹æ³•ï¼Œä½†æˆ‘å€‘æ˜¯åœ¨å“ªè£¡ä½¿ç”¨ `getEvent` å‘¢ï¼Ÿ

ä¾†çœ‹çœ‹æœ€å¾Œä¸€å€‹ **view** çµ„ä»¶ï¼š**EventShow**)

ğŸ“ƒ **/src/views/EventShow.vue**

```javascript
    <script>
    import EventService from '@/services/EventService.js'
    
    export default {
      props: ['id'],
      data() {
        return {
          event: {}
        }
      },
      created() {
        EventService.getEvent(this.id)
          .then(response => {
            this.event = response.data
          })
          .catch(error => {
            console.log('There was an error:', error.response)
          })
      }
    }
    </script>
```

ç•¶çµ„ä»¶é€²å…¥ `created` é‰¤å­(hook)æ™‚ï¼Œæœƒå‘¼å« `getEvent` APIï¼Œå‚³å…¥è‡ªå·±çš„å±¬æ€§`(this.id)`ç•¶ä½œåƒæ•¸ä¾†å–å¾—æ´»å‹•ã€‚é€™å€‹çµ„ä»¶æ¥è‘—å°‡å®ƒ **data** ä¸­çš„ `event` ç‰©ä»¶è¨­å®šç‚º `response.data`ï¼ˆå¦‚æœæœ‰éŒ¯èª¤å‰‡æœƒåœ¨ console ä¸Šå°å‡ºéŒ¯èª¤è¨Šæ¯ï¼‰ã€‚

ğŸ“ƒ **/src/views/EventShow.vue**

```javascript
    <template>
      <div>
        <div class="event-header">
          <span class="eyebrow">@{{ event.time }} on {{ event.date }}</span>
          <h1 class="title">{{ event.title }}</h1>
          <h5>Organized by {{ event.organizer }}</h5>
          <h5>Category: {{ event.category }}</h5>
        </div>
        <BaseIcon name="map"><h2>Location</h2></BaseIcon>
        <address>{{ event.location }}</address>
        <h2>Event details</h2>
        <p>{{ event.description }}</p>
        <h2>Attendees
          <span class="badge -fill-gradient">{{ event.attendees ? event.attendees.length : 0 }}</span>
        </h2>
        <ul class="list-group">
          <li v-for="(attendee, index) in event.attendees" :key="index" class="list-item">
            <b>{{ attendee.name }}</b>
          </li>
        </ul>
      </div>
    </template>
```

åœ¨é€™å€‹æ¨£æ¿ä¸­ï¼Œæˆ‘å€‘å°‡å¾ `getEvent` API å‘¼å«å–å›çš„ `event` ç‰©ä»¶ä¸­å–å¾—çš„è©³ç´°è³‡è¨Šé¡¯ç¤ºåœ¨çµ„ä»¶ä¸­ã€‚

é‚£éº¼æˆ‘å€‘åˆæ˜¯å¾é‚£é‚Šå¾—åˆ° `id` çš„å±¬æ€§å€¼å‘¢ï¼Ÿè¦äº†è§£é€™å€‹ï¼Œæˆ‘å€‘å°±å¿…é ˆå»çœ‹çœ‹ **router.js** é€™æ”¯æª”æ¡ˆä¾†çœ‹çœ‹æˆ‘å€‘æ˜¯æ€éº¼ä½¿ç”¨ Vue Router çš„ã€‚

## äº†è§£è·¯ç”±

ğŸ“ƒ **/src/router.js**

```javascript
    import Vue from 'vue'
    import Router from 'vue-router'
    import EventCreate from './views/EventCreate.vue'
    import EventList from './views/EventList.vue'
    import EventShow from './views/EventShow.vue'
    
    Vue.use(Router)
    
    export default new Router({
      mode: 'history',
      routes: [
        {
          path: '/',
          name: 'event-list',
          component: EventList
        },
        {
          path: '/event/create',
          name: 'event-create',
          component: EventCreate
        },
        {
          path: '/event/:id',
          name: 'event-show',
          component: EventShow,
          props: true
        }
      ]
    })
```

åœ¨æª”æ¡ˆé ‚ç«¯ï¼Œæˆ‘å€‘ import äº† **view** çµ„ä»¶ï¼Œé€™æ¨£æˆ‘å€‘æ‰èƒ½åœ¨ `routes` è£¡é¢ä½¿ç”¨å®ƒå€‘ã€‚ä½†é¦–å…ˆæˆ‘å€‘å¿…é ˆå‘Šè¨´ Vue å»ä½¿ç”¨ **Router**ï¼Œæ‰€ä»¥æˆ‘å€‘ä¹Ÿåœ¨ä¸Šé¢ import äº† `Vue.use(Router)`

```javascript
    {
      path: '/',
      name: 'event-list',
      component: EventList
    },
```

ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œæ ¹è·¯ç”±(`/`)è¼‰å…¥äº† **EventList** çµ„ä»¶ã€‚

```javascript
    {
      path: '/event/create',
      name: 'event-create',
      component: EventCreate
    },
```

ç•¶æˆ‘å€‘ç€è¦½åˆ° `/event/create` æ™‚ï¼Œ**EventCreate** çµ„ä»¶å°±æœƒè¢«è¼‰å…¥åˆ°ç•«é¢ã€‚

```javascript
    {
      path: '/event/:id',
      name: 'event-show',
      component: EventShow,
      props: true
    }
```

ç•¶æˆ‘å€‘ç€è¦½åˆ° `/event/` å¾Œé¢æ¥è‘—æŸå€‹ `:id` æ™‚ï¼Œapp å°±æœƒè¼‰å…¥ **EventShow** çµ„ä»¶ã€‚å› ç‚ºæˆ‘å€‘è¨­å®šäº† `props:true`ï¼Œé‚£ä»£è¡¨è·¯ç”±çš„å‹•æ…‹ç‰‡æ®µ(`:id`)å°‡æœƒè¢«å‚³å…¥ **EventShow** çµ„ä»¶ç•¶ä½œæ˜¯ `props`ã€‚é€™å°±å›ç­”æˆ‘å€‘æœ€åˆçš„å•é¡Œï¼šæˆ‘å€‘åˆæ˜¯å¾é‚£é‚Šå¾—åˆ° `id` çš„å±¬æ€§å€¼å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œ**å¾ URL åƒæ•¸**ã€‚æ‰€ä»¥åŠ å…¥æˆ‘å€‘çš„ URL æ˜¯ `/event/1`ï¼Œé‚£éº¼ **EventShow** çµ„ä»¶çš„ `id` prop å°‡æœƒæ˜¯ `1`ã€‚

## ç­‰ç­‰ï¼é‚„æœ‰ä¸€é»...

é‚„æœ‰ä¸€å€‹çµ„ä»¶ **NavBar**ï¼Œè£¡é¢å¸¶æœ‰åˆ°å…¶ä»–è·¯ç”±çš„ router-linksã€‚

ğŸ“ƒ **/src/components/NavBar.vue**

```javascript
    <template>
      <div id="nav" class="nav">
        <router-link to="/" class="brand">Real World Events</router-link>
        <nav>
          <router-link :to="{ name: 'event-list' }">List</router-link> |
          <router-link :to="{ name: 'event-create' }">Create</router-link>
        </nav>
      </div>
    </template>
    ...
```

æåˆ° router-linksï¼Œæ³¨æ„åˆ° **EventCard** çµ„ä»¶è£¡é¢ä¹Ÿæœ‰ä¸€å€‹å—ï¼Ÿ

ğŸ“ƒ **/src/components/EventCard.vue**

```javascript
    <router-link class="event-link" :to="{ name: 'event-show', params: { id: event.id } }">
    ... 
    </router-link>
```

é€™æ®µç¨‹å¼ç¢¼è®“æˆ‘å€‘åœ¨é»æ“Š **EventCard** çµ„ä»¶æ™‚è·³åˆ° `/event/:id`ï¼Œå…¶ä¸­ `id` æ˜¯å¾æˆ‘å€‘é»æ“Šçš„ **EventCard** ä¸­çš„ `event.id` prop è€Œä¾†ã€‚
























