<link rel="stylesheet" href="assets/style.css" type="text/css" />
# æ¨¡çµ„

åœ¨ä¸Šå…©å€‹ç« ç¯€æˆ‘å€‘ä½¿ç”¨ Vuex å°è£æ‡‰ç”¨ç¨‹å¼çš„ state ä¸¦ä¸”æ¨™æº–åŒ–ä¿®æ”¹ state çš„æ–¹å¼(ç¶“ç”± Action å’Œ Mutation)ã€‚ä½†æ˜¯éš¨è‘—æ‡‰ç”¨ç¨‹å¼æ¼¸æ¼¸èŒå£¯ï¼Œæˆ‘å€‘æœ€çµ‚æœƒå¯«å‡ºä¸€å€‹å·¨å¤§çš„ `store.js`ã€‚é€™æ™‚å€™å°±æ˜¯ Vuex æ¨¡çµ„ä¸Šå ´çš„æ™‚å€™äº†ï¼Œå®ƒèƒ½è®“æˆ‘å€‘çš„ Vuex ç¨‹å¼ç¢¼ä¿æŒæ•´æ½”è€Œä¸”å®¹æ˜“æ¸¬è©¦ã€‚

## ğŸ›‘ å•é¡Œï¼šç¨‹å¼ç¢¼è©²æ•´ç†ä¸€ä¸‹äº†

åˆ°äº†ç¾åœ¨é€™å€‹åœ°æ­¥ï¼Œæˆ‘å€‘å¿…é ˆæœ‰æ›´å¥½çš„æ–¹å¼ä¾†æ•´ç†æˆ‘å€‘çš„ Vuex ç¨‹å¼ç¢¼ï¼Œå–ä»£å…¨éƒ¨æ”¾åœ¨ `store.js` è£¡é¢ã€‚

## â˜‘ï¸ è§£æ±ºæ–¹æ¡ˆ

Vuex æœ‰å€‹å«æ¨¡çµ„çš„é¸é …ï¼Œå®ƒå¯ä»¥è®“æˆ‘å€‘æŠŠç¨‹å¼ç¢¼åˆ‡æˆä¸åŒçš„æª”æ¡ˆã€‚èˆ‰ä¾‹ä¾†èªªï¼Œå¦‚æœæˆ‘å€‘çš„æ‡‰ç”¨ç¨‹å¼æœ‰ `events` å’Œ `users`ï¼ŒæŠŠæ‰€æœ‰çš„ Stateï¼ŒMutation å’Œ Action å…¨éƒ¨æ”¾åœ¨ **/src/store.js** è®Šæˆä¸€å€‹å¤§æª”æ¡ˆæ˜¯æ²’é“ç†çš„ã€‚åä¹‹ï¼Œæˆ‘å€‘æ‡‰è©²æŠŠå®ƒä¾åŠŸèƒ½åˆ†è§£æˆå…©å€‹ Vuex æ¨¡çµ„ã€‚

![](assets/Ch06/01.gif)

åœ¨ä¹‹å¾Œï¼Œæˆ‘å€‘çš„å¯èƒ½æœƒåœ¨æ´»å‹•ä¸­å¢åŠ é¡å¤–å¦‚æ´»å‹•ç•™è¨€çš„åŠŸèƒ½ï¼Œä»¥åŠåœ¨ä½¿ç”¨è€…å¯åœ¨ä»–å€‘åƒèˆ‡çš„æ´»å‹•ä¸Šæ¨™è¨»"æœƒåƒåŠ "çš„åŠŸèƒ½ã€‚é€™äº›åŠŸèƒ½ä¹Ÿå¯ä»¥æ˜¯å°‡å…¶åˆ‡åˆ†ç‚ºä»–å€‘è‡ªå·±çš„ Vuex æ¨¡çµ„è€ƒé‡ã€‚

æˆ‘å€‘å¯ä»¥åŸºæ–¼è³‡æ–™æ¨¡å‹ä¾†åˆ‡åˆ† Vuex ç¨‹å¼ç¢¼ï¼Œæˆ–è€…åŸºæ–¼åŠŸèƒ½ä¾†åˆ‡ã€‚å…¶å¯¦è¦æ€éº¼åˆ‡åˆ†å¯¦ä½œæ²’æœ‰è¦å®šï¼Œéƒ½æ˜¯æ“ä¹‹åœ¨å·±ã€‚

## ğŸ‘ˆ å›åˆ°ç¯„ä¾‹ app

åœ¨æˆ‘å€‘çš„ç¯„ä¾‹ appï¼Œæˆ‘å€‘å¯ä»¥é–‹å§‹è©¦è‘—å»ºä¸€å€‹ `store` è³‡æ–™å¤¾ï¼Œç„¶å¾ŒæŠŠç¾åœ¨çš„ `store.js` æ¬åˆ°è£¡é¢ã€‚é€™å€‹æ™‚å€™ï¼Œæˆ‘å€‘å…ˆä¾†ä¿®æ”¹ä¸€ä¸‹ `main.js`ï¼Œç¢ºèªåœ¨æª”æ¡ˆæ¬éå»ä¹‹å¾Œä¸€åˆ‡éƒ½é‚„èƒ½æ­£å¸¸é‹ä½œã€‚

```javascript
  import store from './store'
```

æ”¹ç‚ºï¼š

```javascript
  import store from './store/store'
```

é€™æ¨£å°±è¡Œäº†ã€‚

## ğŸ— å»ºç½®ç¬¬ä¸€å€‹æ¨¡çµ„

åœ¨æˆ‘å€‘æ­£å¼é–‹å§‹å»ºç½®ç¬¬ä¸€å€‹æ¨¡çµ„å‰ï¼Œæˆ‘å€‘å…ˆä¾†æ‰¾å€‹åœ°æ–¹åˆ—å°ä½¿ç”¨è€…åç¨±ã€‚å°±æ±ºå®šæŠŠä»–æ”¾åˆ°é¦–é çš„æ¨™é¡Œä¸Šå¥½äº†ã€‚

ğŸ“ƒ **/src/views/EventList.vue**

```javascript
  <template>
    <div>
      <h1>Events for {{ user.name }}</h1>
    </div>
    ...
  </template>
  
  <script>
    // çœç•¥ç¨‹å¼ç¢¼
    ...mapState(['events', 'eventsTotal', 'user'])
  </script>
```

æˆ‘å€‘ä¸¦æ²’æœ‰å¢åŠ æ–°çš„ç¨‹å¼ç¢¼ï¼Œåªæ˜¯æƒ³å‘Šè¨´ä½ åœ¨ `store.js` è£¡é¢æœ‰ä»¥ä¸‹çš„ä½¿ç”¨è€…è³‡æ–™ğŸ‘‡ï¼š

ğŸ“ƒ **/src/store/store.js**

```javascript
  ...
  export default new Vuex.Store({
    state: {
      user: { id: 'abc123', name: 'Young Boy' },
      ...  
```

ç•¶æˆ‘å€‘æ‰“é–‹é¦–é çš„æ™‚å€™å°±å¯ä»¥çœ‹åˆ°ä½¿ç”¨è€…çš„åå­—é¡¯ç¤ºåœ¨ä¸Šé¢ã€‚

ç¾åœ¨è®“æˆ‘å€‘ä¾†å»ºç«‹ç¬¬ä¸€å€‹ **user** æ¨¡çµ„ï¼Œå› ç‚ºå°‡ä¾†æˆ‘å€‘æœƒåœ¨ç¯„ä¾‹ app è£¡é¢åŠ å…¥ä½¿ç”¨è€…é©—è­‰åŠŸèƒ½ï¼Œæˆ‘å€‘æœƒåœ¨é€™é‚Šå¯«æ›´å¤šçš„ç¨‹å¼ç¢¼ã€‚æ‰€ä»¥æˆ‘å€‘è¦ä¾†å»ºç«‹ä¸€å€‹æ–°çš„ **modules** è³‡æ–™å¤¾å’Œ **user.js** æª”ï¼Œè£¡é¢åªåŒ…å« user Stateã€‚

ğŸ“ƒ **/src/store/modules/user.js**

```javascript
  export const state = {
    user: {
      id: 'abc123',
      name: 'Young'
    }
  }
```

ç¾åœ¨ç‚ºäº†è¦ä½¿ç”¨é€™å€‹æ¨¡çµ„ï¼Œæˆ‘å€‘è¦æŠŠå®ƒåŒ…å«åˆ° **store.js** è£¡ï¼Œå°±åƒğŸ‘‡é€™æ¨£ï¼š

ğŸ“ƒ **/src/store/store.js**

```javascript
  ...
  import * as user from '@/store/modules/user.js'
  // é€™ä¸€è¡ŒæœƒæŠ“å‡º user.js è£¡é¢å…¨éƒ¨çš„å¸¸æ•¸
  
  Vue.use(Vuex)
  
  export default new Vuex.Store({
    modules: {
      user // æŠŠ user æ¨¡çµ„åŒ…å«é€²ä¾†
    },
    state: {
      categories: [
        'sustainability',
        // ...
    }
  })
```

ç‚ºäº†è¦è®“å®ƒèƒ½å¤ æ­£å¸¸é‹è¡Œï¼Œæˆ‘å€‘è¦åœ¨çµ„ä»¶è£¡é¢åŠ å…¥å¦ä¸€å€‹ `.user`ï¼š

ğŸ“ƒ **/src/views/EventList.vue**

```html
  <template>
    <div>
      <h1>Events for {{ user.user.name }}</h1>
    </div>
    ...
  </template>
```

æˆ‘å€‘è¦é€™æ¨£æ”¹çš„åŸå› æ˜¯å› ç‚ºåœ¨æ¨¡çµ„è£¡é¢çš„ State æ˜¯ä»¥å®ƒçš„åç¨±ç‚ºç¯„åœã€‚å¾…æœƒæˆ‘å€‘å†ä¾†ä»‹ç´¹ï¼Œæœ‰å¥½å¹¾ç¨®æ–¹æ³•å¯ä»¥æ“ºè„«éœ€è¦å…¨éƒ¨æ”¹æˆ `user.user` çš„éº»ç…©ã€‚

åœ¨é€™ä¹‹å‰æˆ‘ç™¼ç¾æœ‰å€‹åœ°æ–¹çš„ç¨‹å¼ç¢¼ä¹Ÿè¦ä¿®æ”¹æ‰èƒ½ç¬¦åˆæˆ‘å€‘æ–°å¢çš„ **User æ¨¡çµ„**ã€‚

ğŸ“ƒ **/src/views/EventCreate.vue**

```javascript
  ...
  createFreshEventObject() {
    const user = this.$store.state.user // <----
    const id = Math.floor(Math.random() * 9999999)
  ...
```

åœ¨åƒç…§ state çš„æ™‚å€™å¥½æˆ‘å€‘è¦æŠŠ `user` æ”¹ç‚º `user.user`ï¼Œç¨‹å¼ç¢¼æ›´æ–°ç‚ºï¼š

```javascript
  const user = this.$store.state.user.user // <----
```

## ğŸ— å»ºç«‹ Event æ¨¡çµ„

æ¥ä¸‹ä¾†æˆ‘å€‘è¦ä¾†æŠŠæ´»å‹•çš„ Stateï¼ŒMutationï¼ŒAction å’Œ Getter å…¨éƒ¨æ¬åˆ°å±¬æ–¼å®ƒè‡ªå·±çš„ **event.js** æ¨¡çµ„è£¡ã€‚å¤§æ¬å®¶å®Œçš„ç¨‹å¼æœƒåƒğŸ‘‡ï¼š

ğŸ“ƒ **/src/store/modules/event.js**

```javascript
    import EventService from '@/services/EventService.js'
    
    export const state = {
      events: [],
      eventsTotal: 0,
      event: {}
    }
    export const mutations = {
      ADD_EVENT(state, event) {
        state.events.push(event)
      },
      SET_EVENTS(state, events) {
        state.events = events
      },
      SET_EVENTS_TOTAL(state, eventsTotal) {
        state.eventsTotal = eventsTotal
      },
      SET_EVENT(state, event) {
        state.event = event
      }
    }
    export const actions = {
      createEvent({ commit }, event) {
        return EventService.postEvent(event).then(() => {
          commit('ADD_EVENT', event)
        })
      },
      fetchEvents({ commit }, { perPage, page }) {
        EventService.getEvents(perPage, page)
          .then(response => {
            commit('SET_EVENTS_TOTAL', parseInt(response.headers['x-total-count']))
            commit('SET_EVENTS', response.data)
          })
          .catch(error => {
            console.log('There was an error:', error.response)
          })
      },
      fetchEvent({ commit, getters }, id) {
        var event = getters.getEventById(id)
        if (event) {
          commit('SET_EVENT', event)
        } else {
          EventService.getEvent(id)
            .then(response => {
              commit('SET_EVENT', response.data)
            })
            .catch(error => {
              console.log('There was an error:', error.response)
            })
        }
      }
    }
    export const getters = {
      getEventById: state => id => {
        return state.events.find(event => event.id === id)
      }
    }
```

é€™é‚Šè¦æ³¨æ„çš„æ˜¯æˆ‘å€‘æŠŠ `import EventService from '@/services/EventService.js` ä¹Ÿä¸€èµ·æ¬é€²é€™å€‹æª”æ¡ˆã€‚æ¥ä¸‹ä¾†æˆ‘å€‘éœ€è¦åœ¨ **store.js** æŠŠé€™å€‹æ¨¡çµ„åŒ…å«é€²ä¾†ï¼š

ğŸ“ƒ **/src/store/store.js**

```javascript
  import Vue from 'vue'
  import Vuex from 'vuex'
  import * as user from '@/store/modules/user.js'
  import * as event from '@/store/modules/event.js'
  
  Vue.use(Vuex)
  
  export default new Vuex.Store({
    modules: {
      user,
      event
    },
    state: {
      categories: [ ... ]
    }
  })
```

ç¾åœ¨å›åˆ°ç€è¦½å™¨çœ‹çš„è©±ï¼Œä½ ä»€éº¼éƒ½çœ‹ä¸åˆ°ã€‚å› ç‚ºåŸä¾†çš„ `events`ï¼Œ`eventTotal` å’Œ `event` State ç¾åœ¨è¦æ”¹å¯«æˆ `event.events`ï¼Œ`event.eventTotal` å’Œ `event.event`ã€‚æ‰€ä»¥æˆ‘å€‘é‚„æœ‰å…©å€‹æª”æ¡ˆè¦æ”¹ã€‚

ğŸ“ƒ **/src/views/EventList.vue**

```javascript
  <template>
    <div>
      <h1>Events for {{ user.name }}</h1>
      <EventCard v-for="event in event.events"
        :keys="event.id" :event="event" />
      ...
    </div>
  </template>
  <script>
    ...
    hasNextPage() {
      return this.event.eventsTotal > this.page * this.perPage
    },
    ...mapState(['event', 'user'])
  </script>
```

æˆ‘å€‘å°ä¸Šé¢é€™å€‹æª”æ¡ˆä¿®æ”¹ä¸‰å€‹åœ°æ–¹ï¼Œç¬¬ä¸€å€‹åœ¨æœ€ä¸‹é¢ï¼Œæˆ‘å€‘æŠŠ `mapState` çš„æ´»å‹•éƒ¨åˆ†æ”¹ç‚º `event`ï¼ˆé€™æ¨£æœƒå°æ‡‰çš„æˆ‘å€‘å‰›å‰›æ˜æ˜çš„ `event` æ¨¡çµ„ï¼‰ã€‚ç„¶å¾Œæˆ‘å€‘åªéœ€è¦ç¢ºå®šåœ¨æ´»å‹•å‰é¢åŠ ä¸Š`event.`ã€‚

è€Œåœ¨ **EventShow.vue** è£¡é¢ï¼ŒåŸæœ¬çš„ `event` å·²ç¶“åœ¨æª”æ¡ˆè£¡åˆ°è™•ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘å€‘æ¡ç”¨å¦ä¸€å€‹æ–¹æ³•è§£æ±ºï¼Œé™¤äº†åœ¨å‰é¢åŠ ä¸Š `event.` çš„å¯«æ³•ï¼Œé‚„æœ‰å¦ä¸€å€‹åˆ©ç”¨ `mapState` å°å¹«æ‰‹çš„æ–¹å¼ï¼Œåœ¨[State èˆ‡ Getter](3.-state-and-getters.md)è£¡é¢å­¸éã€‚

æˆ‘å€‘æœƒä¾†åˆ©ç”¨ `computed` å±¬æ€§ï¼ŒæŠŠ `computed: mapState(['event']ï¼‰æ”¹ç‚ºï¼š

ğŸ“ƒ **/src/views/EventShow.vue**

```javascript
  ...
  computed: mapState({
    event: state => state.event.event
  })
```

é€™é‚Šæˆ‘å€‘æŠŠ `event` é€™å€‹ `computed` å±¬æ€§çš„å…§å®¹è¨­å®šç‚º `event` æ¨¡çµ„è£¡é¢çš„ `event` Stateã€‚

å¥½çš„ç¾åœ¨ä¸€åˆ‡åˆæ¢å¾©é æœŸçš„çµæœäº†ï¼Œè€Œä¸”ç•¶æˆ‘å€‘åœ¨ **EventShow.vue** è£¡é¢å¯« `event.time` çš„æ™‚å€™ï¼Œä»–æœƒå°æ‡‰åˆ° `event.event.time` Stateã€‚

![](assets/Ch06/02.gif)

## åœ¨å…¶ä»–æ¨¡çµ„å­˜å– State

å›åˆ° **Mutation èˆ‡ Action - å–®å…ƒä¸€** ç« ç¯€ï¼Œæˆ‘å€‘å‰µå»ºäº† `event` Actionï¼Œç¾åœ¨é€™å€‹ State åœ¨ **/store/modules/event.js** é€™å€‹æª”æ¡ˆè£¡é¢ğŸ‘‡ï¼š

```javascript
  ...
  export const actions = {
    createEvent({ commit }, event) {
      return EventService.postEvent(event).then(() => {
        commit('ADD_EVENT', event) 
      })
    },
  ...
```

åœ¨æœªä¾†æˆ‘å€‘å¯èƒ½æœƒæƒ³è¦å¾é€™å€‹ Action è£¡é¢å­˜å– `user` Stateã€‚é€™æ¨£è©²æ€éº¼åšå‘¢ï¼Ÿå¦‚æœæˆ‘å€‘ä¸æ˜¯ç”¨æ¨¡çµ„çš„è©±å¯ä»¥åˆ©ç”¨æ¡†æ¶(context)ç‰©ä»¶ä¾†å­˜å–ğŸ‘‡ï¼š

```javascript
  createEvent({ commit, state }, event) {
    console.log('User creating Event is '+ state.user.user.name)
    
    return EventService.postEvent(event).then(() => {
      commit('ADD_EVENT', event)
    })
  },
```

ä½†å› ç‚ºæˆ‘å€‘ç¾åœ¨å·²ç¶“è©²ç”¨æ¨¡çµ„äº†ï¼Œæ‰€ä»¥**ä¸èƒ½é€™æ¨£å¯«**ã€‚é€™è£¡çš„ `state` ç‰©ä»¶åªæ˜¯æœ¬åœ°ç«¯æ¨¡çµ„è£¡çš„ `state`ï¼Œæ‰€ä»¥è¦å­˜å– `user` Stateï¼Œæˆ‘å€‘è¦åˆ©ç”¨ `rootState` é€™å€‹ç‰©ä»¶ï¼Œå¾å®ƒçš„åå­—å¯ä»¥çŒœå¾—å‡ºä¾†ï¼Œå®ƒå¯ä»¥è®“æˆ‘å€‘å­˜å–æ ¹ Vuex Stateã€‚

```javascript
  createEvent({ commit, rootState }, event) {
    console.log('User creating Event is ' + rootState.user.user.name)
    
    return EventService.postEvent(event).then(() => {
      commit('ADD_EVENT', event)
    })
  },
```

é€™è£¡å¯«åˆ° `rootState.user.user.name`ï¼Œåˆ©ç”¨æ ¹ Stateï¼Œæˆ‘å€‘å¯ä»¥å­˜å–åˆ° **user** æ¨¡çµ„ï¼Œç„¶å¾Œå°±å¯ä»¥å¾ **user** æ¨¡çµ„å–å¾— `name` Stateã€‚

åŒæ¨£çš„æˆ‘å¯ä»¥ç”¨ç›¸åŒçš„æ–¹å¼å­˜å– `rootGetters` ä¾†å–å¾—åœ¨ä¸åŒæ¨¡çµ„è£¡é¢çš„ Getterã€‚

## å­˜å–å…¶ä»–æ¨¡çµ„çš„ Action

åŒæ¨£çš„å¾è‡ªèº« Action å‘¼å«å…¶ä»–æ¨¡çµ„çš„ Actionä¹Ÿæ˜¯å¾ˆå¸¸è¦‹çš„ã€‚æˆ‘å€‘å¯ä»¥ç°¡å–®çš„å¾æ¡†æ¶(contex)ç‰©ä»¶å‚³å…¥ `dispatch`ç„¶å¾Œç”¨å®ƒä¾†å‘¼å« Actionã€‚

```javascript
  createEvent({ commit, dispatch, rootState }, event) {
    console.log('User creating Event is ' + rootState.user.user.name)
    
    dispatch('actionToCall')
    
    return EventService.postEvent(event).then(() => {
      commit('ADD_EVENT', event)
    })
  },
```

æ˜¯çš„ï¼æˆ‘å€‘ä¸ç”¨æŒ‡å‡º `actionToCall` åœ¨å“ªå€‹æ¨¡çµ„è£¡é¢ã€‚åŸå› æ˜¯å…¨éƒ¨çš„ Actionï¼ŒMutation å’Œ Getter éƒ½ä½åœ¨å…¨åŸŸçš„å‘½åç©ºé–“ã€‚

## äº†è§£å…¨åŸŸå‘½åç©ºé–“

å†é‡è¤‡ä¸€éï¼š**Actionï¼ŒMutation å’Œ Getterï¼ˆç”šè‡³æ˜¯åœ¨æ¨¡çµ„è£¡é¢çš„ï¼‰éƒ½è¨»å†Šåœ¨å…¨åŸŸå‘½åç©ºé–“ä¸‹**ã€‚é€™ä»£è¡¨ä¸ç®¡ä½ åœ¨å“ªé‚Šå®£å‘Šå‘¼å«çš„æ™‚å€™éƒ½ä¸ç”¨åŠ ä¸Šæ¨¡çµ„åç¨±ã€‚æ‰€ä»¥ä½ çœ‹çœ‹ä¸‹é¢çš„ç¨‹å¼ç¢¼ï¼Œéƒ½æ²’æœ‰æåˆ°æ¨¡çµ„åç¨±å–”ï¼šğŸ‘‡

```javascript
  this.$store.dispatch('someAction')
  this.$store.getters.filteredList
```

é€™æ˜¯æ•…æ„é€™æ¨£è¨­è¨ˆçš„ï¼Œå¥½è®“å¤šå€‹æ¨¡çµ„å¯ä»¥å›æ‡‰ç›¸åŒçš„ Mutation/Actionã€‚
æ²’éŒ¯ï¼ä½ å¯èƒ½æœƒç™¼ç¾ä¸€ç¨®æƒ…æ³ï¼Œæœ‰å…©å€‹ä¸åŒæ¨¡çµ„ï¼Œä¸€å€‹ç”¨åœ¨çµå¸³å¦ä¸€å€‹ç”¨åœ¨è¨˜éŒ„ï¼Œå®ƒå€‘å…©è€…éƒ½æœƒç›£è½ "completePurchase" Actionã€‚çµå¸³æ¨¡çµ„æœƒç”¨ä¾†é€²è¡Œçµå¸³è€Œè¨˜éŒ„æ¨¡çµ„æœƒè¨˜éŒ„çµå¸³ç™¼ç”Ÿçš„è¨˜éŒ„ã€‚

âš ï¸ åƒé€™æ¨£çš„å¯¦ä½œçš„æœƒå¤±æ•—çš„åŸå› å°±æ˜¯æˆ‘å€‘æœƒä»¥å‘½åè¡çªæ”¶å ´ã€‚æˆ‘å€‘å¸Œæœ›æˆ‘å€‘çš„ Actionï¼ŒMutation å’Œ Getter æ°¸é ä¸è¦ç™¼ç”Ÿé€™æ¨£çš„è¡çªã€‚é€™å°±æ˜¯ç‚ºä½•æˆ‘å€‘è¦é–‹å•Ÿå‘½åç©ºé–“äº†ã€‚

## â˜‘ï¸ å°æ¨¡çµ„å®šç¾©å‘½åç©ºé–“

å¦‚æœæƒ³è¦æ¨¡çµ„èƒ½å¤ ç¨ç«‹ï¼Œå¯é‡ç”¨è€Œä¸”ä¹Ÿè¨±é¿å…ä¸å°å¿ƒå…©å€‹æ¨¡çµ„æœ‰ç›¸åŒåç¨±çš„ Action...ï¼Œé€™æ˜¯å°±è¦å°æ¨¡çµ„å®šç¾©å‘½åç©ºé–“

æˆ‘å€‘å…ˆä¾†å®šç¾© **event.js** æ¨¡çµ„

ğŸ“ƒ **/src/store/modules/event.js**

```javascript
  import EventService from '@/services/EventService.js'
  
  export const namespaced = true
  
  export const state = {
    events: [],
    ...
```

åœ¨è£¡é¢å¢åŠ ä¸€è¡Œçš„çµ„æ…‹è¨­å®šï¼Œæˆ‘å€‘çš„ Actionï¼ŒMutation å’Œ Getter ç¾åœ¨å°±å¿…é ˆåœ¨ä½¿ç”¨çš„æ™‚å€™æŒ‡å®šå‘½åç©ºé–“ã€‚å› æ­¤åœ¨ **EventList.vue** æœƒå¾ğŸ‘‡ï¼š

```javascript
  this.$store.dispatch('fetchEvents',{ ... })
```

è®Šæˆ

```javascript
  this.$store.dispatch('event/fetchEvents', { ... })
```

**EventCreate.vue** å¾ï¼š

```javascript
  this.$store.dispatch('createEvent', this.event)
```

è®Šæˆ

```javascript
  this.$store.dispatch('event/createEvent', this.event)
```

**EventShow.vue** å¾ï¼š

```javascript
  this.$store.dispatch('fetchEvent', this.id)
```

è®Šæˆ

```javascript
  this.$store.dispatch('event/fetchEvent', this.id)
```

é€™æ¨£å°±å®Œæˆä¿®æ”¹äº†ã€‚

## é—œæ–¼ mapActions

åœ¨é€™å€‹ç« ç¯€æˆ‘å€‘é‚„æ²’æåˆ° `mapActions` å°å¹«æ‰‹ï¼Œå®ƒçš„ä½œç”¨èƒ½è®“æˆ‘å€‘å°‡çµ„ä»¶æ–¹æ³•å°æ‡‰çš„ `store.dispatch` å‘¼å«ã€‚æ‰€ä»¥åŸä¾†çš„ğŸ‘‡ï¼š

ğŸ“ƒ **/src/views/EventShow.vue**

```javascript
  import { mapState } from 'vuex'
  
  export default {
    props: ['id'],
    created() {
      this.$store.dispatch('event/fetchEvent', this.id)
    },
    computed: mapState({
      event: state => state.event.event
    })
  }
```

å¯ä»¥ä¿®æ”¹æˆï¼š

```javascript
  import { mapState, mapActions } from 'vuex'
  
  export default {
    props: ['id'],
    created() {
      this.fetchEvent(this.id)
    },
    computed: mapState({
      event: state => state.event.event
    }),
    methods: mapActions('event', ['fetchEvent'])
  }
```

æ³¨æ„é€™é‚Šæˆ‘å€‘å¦‚ä½•åŒ¯å…¥äº† `mapActions`ï¼Œå¦‚ä½•åˆ©ç”¨é€™å€‹å°å¹«æ‰‹æ­é… `methods:` å±¬æ€§ï¼Œä»¥åŠå®ƒå¦‚ä½•è®“æˆ‘å€‘å¯ä»¥ç°¡åŒ–çµ„ä»¶çš„ç¨‹å¼ç¢¼ã€‚`mapActions` çš„ç¬¬ä¸€å€‹çµ„ä»¶æ˜¯å‘½åç©ºé–“ï¼Œç¬¬äºŒå€‹å‰‡æ˜¯æˆ‘å€‘æƒ³è¦ä½œç‚ºçµ„ä»¶æ–¹æ³•çš„åç¨±é™£åˆ—ã€‚

## å­˜å–å¸¶æœ‰å‘½åç©ºé–“çš„ Getter

é›–ç„¶ç›®å‰çš„ç¨‹å¼ç¢¼ä¸­æˆ‘å€‘æ²’æœ‰å­˜å–åˆ°ä»»ä½•çš„ Getterï¼Œä½†åœ¨æˆ‘å€‘ State èˆ‡ Getter ç« ç¯€ä¸­æœ‰é€™æ¨£çš„ç¨‹å¼ç¢¼ğŸ‘‡ï¼š

```javascript
  computed: {
    getEventById() {
      return this.$store.getters.getEventById
    }
  }
```

ç”¨ `mapGetters` å¯ä»¥ç°¡åŒ–æˆğŸ‘‡ï¼š

```javascript
  computed: mapGetters(['getEventById'])
```

å¦‚æœæˆ‘å€‘æƒ³è¦åœ¨ event æ¨¡çµ„è£¡é¢å­˜å–å¸¶æœ‰å‘½åç©ºé–“çš„ Getterï¼Œæˆ‘å€‘åŸæœ¬æ˜¯é€™æ¨£åšğŸ‘‡ï¼š

```javascript
  computed: {
    getEventById() {
      return this.$store.getters['event/getEventById']
    }
  }
```

ç¾åœ¨å¯ä»¥ç°¡åŒ–æˆğŸ‘‡ï¼š

```javascript
  computed: mapGetters('event', ['getEventById'])
```

## æœ‰ç¨‹å¼ç¢¼è¦è·Ÿè‘—å¸¶å‘½åç©ºé–“æ¨¡çµ„è€Œæ”¹è®Šå—ï¼Ÿ

é‚„è¨˜å¾—ä¹‹å‰çš„ç¨‹å¼ç¢¼å—ï¼š

```javascript
  createEvent({ commit, dispatch, rootState }, event) {
  
    console.log('User creating Event is ' + rootState.user.user.name)
    
    dispatch('actionToCall')
    
    return EventService.postEvent(event).then(() => {
      commit('ADD_EVENT', event)
    })
  },
```

å‡è¨­æ‰€æœ‰çš„æ¨¡çµ„éƒ½å¸¶æœ‰å‘½åç©ºé–“ï¼Œé€™æ¨£æˆ‘å€‘è¦ä¿®æ”¹ç¨‹å¼ç¢¼å—ï¼Ÿ

`rootState.user.user.name` æ˜¯æ­£ç¢ºçš„ï¼Œæ²’æœ‰åœ°æ–¹è¦ä¿®æ”¹ã€‚
`dispatch('actionToCall')` åªæœ‰ä¸åœ¨é€™å€‹æ¨¡çµ„å‘¼å«çš„æ™‚å€™éœ€è¦ä¿®æ”¹ã€‚

`commit('ADD_EVENT', event)` åªéœ€è¦åœ¨ Mutation ä¸åœ¨æœ¬åœ°æ¨¡çµ„çš„æ™‚å€™ä¿®æ”¹ï¼Œè€å¯¦èªªé€™ä¸ç®—æ˜¯æœ€å¥½çš„ä½œæ³•ã€‚æœ€å¥½çš„ä½œæ³•æ˜¯æ°¸é ä¸è¦å‘¼å«å…¶ä»–æ¨¡çµ„çš„ Mutationï¼Œåªè®“ Mutation åœ¨è‡ªå·±æ¨¡çµ„çš„ Aciton è£¡é¢å‘¼å«ã€‚æ‰€ä»¥æˆ‘å€‘å°±ä¸è¬›è¦æ€éº¼åœ¨å…¶ä»–æ¨¡çµ„å‘¼å« Mutationï¼Œå› ç‚ºæˆ‘å€‘ä¸æ‡‰è©²é€™æ¨£åšã€‚

## è¦å¦‚ä½•åœ¨ Action ä¸­å‘¼å« Action

åœ¨å¯«ç¨‹å¼çš„éç¨‹ä¸­ï¼Œæˆ‘å€‘å¯èƒ½æœƒç¢°åˆ°å¾ä¸€å€‹ Action è£¡é¢å‘¼å«å¦ä¸€å€‹ Action çš„æƒ…å¢ƒã€‚å¾ˆç°¡å–®ï¼Œæ²’ä»€éº¼å•é¡Œã€‚å¦‚æœè¦å‘¼å«çš„ Action åœ¨ç›®å‰çš„æ¨¡çµ„ä¸­ï¼ˆæˆ–è€…ä½ æ²’æœ‰å•Ÿç”¨å‘½åç©ºé–“ï¼‰çš„æ™‚å€™åªè¦é€™æ¨£å¯«ğŸ‘‡ï¼š

ğŸ“ƒ **/src/store/modules/event.js**

```javascript
  ...
  actions: {
    createEvent({ commit, dispatch }, event) {
      ...
      dispatch('actionToCall')
    }
  ...
```

æ³¨æ„åˆ° `dispatch` å¦‚ä½•å¾æ¡†æ¶(context)ç‰©ä»¶åŒ…å«é€²ä¾†ï¼Œè€Œä¸”å¾ˆç°¡å–®çš„å‘¼å«é€™å€‹ Actionï¼Œå‚³å…¥é…¬è¼‰(å¦‚æœéœ€è¦çš„è©±ï¼‰ã€‚

## é‚£å¦‚æœæˆ‘æƒ³è¦å‘¼å«çš„ Action åœ¨åˆ¥çš„å•Ÿç”¨å‘½åç©ºé–“çš„æ¨¡çµ„è£¡é¢å‘¢ï¼Ÿ

å¦‚æœæƒ³è¦åœ¨å¦ä¸€å€‹å•Ÿç”¨å‘½åç©ºé–“çš„æ¨¡çµ„è£¡é¢ï¼Œæœƒéœ€è¦é€™å€‹ Action çš„æ¨¡çµ„åç¨±ï¼Œæä¾›`payload`ä½œç‚ºç¬¬äºŒå€‹å¼•æ•¸(å¦‚æœæ²’æœ‰çš„è©±å°±å‚³ `null`)ï¼Œç„¶å¾Œå‚³å…¥ `{ root: true }` ç•¶ä½œç¬¬ä¸‰å€‹å¼•æ•¸ï¼ŒåƒğŸ‘‡é€™æ¨£ï¼š

ğŸ“ƒ **/src/store/modules/event.js**

```javascript
  ...
    actions: {
      createEvent({ commit, dispatch }, event) {
        ...
        dispatch('moduleName/actionToCall', null, { root: true })
      }
    ...
```

## é‡é»æ‘˜è¦

åœ¨é€™å€‹ç« ç¯€æˆ‘å€‘å­¸åˆ°äº†è¦æ€éº¼æ•´ç† Vuex ç¨‹å¼ç¢¼ï¼Œä¿æŒå®ƒçš„å¯æ“´å……æ€§ã€‚é¦–å…ˆï¼Œæˆ‘å€‘æ•´ç†äº†åŸä¾†çš„ Vuex ç¨‹å¼ç¢¼ï¼ŒæŠŠå®ƒæ‹†è§£æˆæ¨¡çµ„ä¸¦ä¸”é‡æ§‹ç¨‹å¼ç¢¼è®“å®ƒåœ¨å»ºç«‹æ¨¡çµ„å¾Œå¯ä»¥æ­£å¸¸é‹è¡Œã€‚ä¹‹å¾Œæˆ‘å€‘è«‡åˆ° Vue çš„å‘½åç©ºé–“ï¼Œé€²ä¸€æ­¥çš„å°è£ Acitonï¼ŒMutation å’Œ Getterã€‚

































































