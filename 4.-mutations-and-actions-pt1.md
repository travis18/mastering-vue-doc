<link rel="stylesheet" href="assets/style.css" type="text/css" />
# Mutation èˆ‡ Action - å–®å…ƒä¸€

ç¾åœ¨æˆ‘å€‘å­¸æœƒäº†è¦æ€éº¼å­˜å– Vuex Stateï¼Œå¯ä»¥é–‹å§‹ä¾†æŠŠæ‡‰ç”¨ç¨‹å¼çš„è³‡æ–™å„²å­˜åœ¨è£¡é¢äº†ã€‚è¦åšå°±è¦åˆ©ç”¨ Mutation ä¾†æŠŠè³‡æ–™å¯«å…¥ stateã€‚åœ¨é€™å€‹ç« ç¯€è£¡æˆ‘å€‘è¦ä¾†ä»‹ç´¹ Mutationï¼Œç„¶å¾Œå†äº†è§£å¦‚ä½•å°‡ Mutation æ‰“åŒ…åˆ° Action è£¡é¢è®“æˆ‘å€‘çš„ state èƒ½ä¿æŒæœªä¾†çš„æ“´å……æ€§ã€‚

## Mutation

åœ¨[Vuex ä»‹ç´¹](1.-intro-to-vuex.md)é‚£å€‹ç« ç¯€ï¼Œæˆ‘å€‘ä»‹ç´¹éäº†å¯ä»¥åˆ©ç”¨ Mutation ä¾†æ›´æ–°æˆ– mutate æˆ‘å€‘çš„ State å…§å®¹ã€‚

èˆ‰å€‹æ —å­ï¼Œæˆ‘å€‘çš„ State è£¡é¢æœ‰å€‹ `count` å±¬æ€§ï¼š

**store.js**

```javascript
  state: {
    count: 0
  }
```

ç¾åœ¨åœ¨ state ä¸‹ï¼Œæˆ‘å€‘å¯ä»¥å¯«ä¸€å€‹ mutation ä¾†å¢åŠ å®ƒçš„æ•¸å€¼ã€‚

**store.js**

```javascript
  mutations: {
    INCREMENT_COUNT(state) {
      state.count += 1
    }
  }
```

å¦‚ä¸Šé¢çš„ç¨‹å¼ç¢¼ï¼Œ`INCREMENT_COUNT` é€™å€‹ mutation å°‡æˆ‘å€‘çš„ Vuex ç•¶ä½œåƒæ•¸ä¸¦ä¸”åˆ©ç”¨å®ƒä¾†å¢åŠ  `count` çš„æ•¸å€¼ã€‚

ç¾åœ¨æˆ‘å€‘ä¾†è©¦è©¦çœ‹åœ¨çµ„ä»¶ä¸­ *commit* é€™å€‹ Mutationã€‚åœ¨ **EventCreate** çµ„ä»¶è£¡é¢ï¼Œæˆ‘å€‘æœƒå¢åŠ ä¸€å€‹æ–¹æ³•ï¼š

```javascript
  incrementCount() {
    this.$store.commit('INCREMENT_COUNT')
  }
```

é€™é‚Šæˆ‘å€‘çš„ `incrementCount` æ–¹æ³•åªæ˜¯å¾ˆå–®ç´”çš„ commit `INCREMENT_COUNT` é€™å€‹å¾ `this.$store` å–å¾—çš„ Mutationã€‚

å¦‚æœå†å¢åŠ ä¸€å€‹ button çš„è©±ï¼Œæˆ‘å€‘å¯ä»¥é»æ“Šå®ƒä¾†è§¸ç™¼ Mutationã€‚

```html
  <button @click="incrementCount">Increment</button>
```

æª¢æŸ¥ Vue DevTools æˆ‘å€‘å¯ä»¥çœ‹åˆ° `count` åœ¨ Vuex tab é¡¯ç¤ºçš„å…§å®¹è¢«æ›´æ–°äº†ã€‚

![](assets/Ch04/01.png)

åŒæ¨£çš„ï¼Œæ³¨æ„æˆ‘å€‘çš„ Mutation ä¹Ÿè¢« log åˆ° DevTools è£¡é¢äº†ã€‚å‡å¦‚æˆ‘å€‘é»æ“Š **Base State**ï¼Œæˆ‘å€‘å¯ä»¥çœ‹åˆ° Mutation è¢« commit ä¹‹å‰çš„ Stateï¼Œä¹Ÿå°±æ˜¯èªª `count` å€¼å€’è½‰ç‚º 0 äº†ã€‚

é€™å€‹å·¥å…·è®“æˆ‘å€‘å¯ä»¥åšåˆ° "é™¤éŒ¯çš„æ™‚é–“æ—…è¡Œ"ï¼Œå¦‚æ­¤æˆ‘å€‘èƒ½å¤ çœ‹åˆ° State åœ¨æŒ‡å®šæ™‚é–“é»æ™‚çš„å…§å®¹ï¼Œè€Œä¸”æˆ‘å€‘ä¹Ÿèƒ½äº†è§£ Mutation å¦‚ä½•å½±éŸ¿æˆ‘å€‘çš„ Stateã€‚

### ç‚ºä½• Mutation åç¨±éƒ½æ˜¯å¤§å¯«ï¼š

å¦‚æœä½ ç–‘æƒ‘ç‚ºä½•æ‰€æœ‰çš„ Mutation åç¨±éƒ½æ˜¯å¤§å¯«å­—æ¯ï¼Œé‚£æ˜¯å› ç‚ºåœ¨ä¸€èˆ¬ Flux-based æ¨¡å¼æœƒæŠŠå®ƒå€‘çš„åç¨±éƒ½å®£å‘Šç‚ºå¤§å¯«å­—æ¯ã€‚

é€™æ¨£çš„ä½œæ³•å®Œå…¨ä¸å¼·åˆ¶çš„ï¼Œè€Œä¸”ä¹Ÿæœƒå¸¸çœ‹åˆ° Mutation ä»¥é§å³°è¡¨ç¤ºæ³•å‘½åçš„ä¾‹å­ã€‚å…¨éƒ¨å¤§å¯«çš„ç¢ºä½¿å¾—åœ¨çœ‹æª”æ¡ˆå…§å®¹çš„æ™‚å€™æ›´ç›´æ¥æ¸…æ¥šæœ‰å“ªäº›å¯ç”¨çš„ Mutationã€‚è€Œä¸”åœ¨ Mutation vs Actionï¼ŒGetter ç­‰ç­‰æƒ…å½¢ï¼Œå…¨å¤§å¯«è®“ä½ æ›´å®¹æ˜“åˆ†è¾¨ commit çš„æ˜¯ Mutationã€‚

## å‹•æ…‹ Mutation

ç¾åœ¨æˆ‘å€‘å° `count` ä¸€æ¬¡åªå¢åŠ  1ã€‚é‚£å¦‚æœæˆ‘å€‘æƒ³è¦ä¸€æ¬¡å¢åŠ ä¸€å€‹ä¸å›ºå®šçš„æ•¸å€¼çš„è©±å‘¢ï¼Ÿæˆ‘å€‘å¯ä»¥å‚³çµ¦ Mutation ä¸€å€‹é…¬è¼‰(payload)ä¾†è®“å®ƒå‹•æ…‹ä¿®æ”¹ã€‚

æˆ‘å€‘ä¾†åœ¨æ¨£æ¿è£¡é¢å¢åŠ ä¸€å€‹ `input` æ¨™ç±¤ï¼Œç„¶å¾Œåˆ©ç”¨ `v-model` ç¶å®šåˆ°ä¸€å€‹æ–°å¢çš„ `data` å±¬æ€§ `incrementBy` ä¾†åšé€™å€‹ç·´ç¿’ã€‚

```html
  <input type="number" v-model.number="incrementBy" />
```

é€™é‚Šæ³¨æ„ä¸€ä¸‹æˆ‘å€‘ä½¿ç”¨ `.number` è£é£¾å­(modifier)ä¾†å°‡è¼¸å…¥å€¼è½‰ç‚ºæ•¸å­—å‹åˆ¥ã€‚

```javascript
  data() {
    return {
      incrementBy: 1
    }  
  }
```

ç„¶å¾Œæˆ‘å€‘åœ¨ commit Mutation çš„æ™‚å€™æŠŠ `data` è£¡é¢çš„ `incrementBy` ç•¶ä½œé…¬è¼‰å‚³å…¥ã€‚

```javascript
  incrementCount() {
    this.$store.commit('INCREMENT_COUNT', this.incrementBy)
  },
```

åœ¨ Vuex Store ä¸­ï¼Œ`INCREMENT_COUNT` èƒ½å¤ æ¥æ”¶ commit çš„ç¬¬äºŒå€‹å¼•æ•¸ç•¶ä½œé…¬è¼‰(payload)ï¼Œä¸¦åˆ©ç”¨å®ƒä¾†å‹•æ…‹æ›´æ–° `count` çš„æ•¸å€¼ã€‚

```javascript
  INCREMENT_COUNT(state, value) {
    state.count += value
  }
```

å¦‚æ­¤ä»¥ä¾†åœ¨ `input` æ§åˆ¶é …è¼¸å…¥çš„å€¼å°±èƒ½è¢«ç”¨ä¾†æ›´æ–° `count` State å€¼äº†ã€‚

## Actions

å› ç‚º Vuex Mutation æ˜¯åŒæ­¥çš„ï¼Œæ„æ€æ˜¯æœƒä¸€å€‹å®Œæˆå¾Œæ‰æœƒåŸ·è¡Œä¸‹ä¸€å€‹ï¼Œè€Œ Action æ˜¯éåŒæ­¥çš„ã€‚ä»–å€‘å¯ä»¥åŒ…å«å¤šå€‹æ­¥é©Ÿï¼Œè€Œä¸”å¯¦éš›åŸ·è¡Œçš„æ™‚å€™è·Ÿä½ ç•¶åˆå¯«çš„é †åºä¸åŒã€‚å¦‚æœä½ é‚„è¨˜å¾—å‰é¢ç« ç¯€æœ‰é—œ API çš„å‘¼å«æ–¹æ³•çš„è©±ï¼ŒAxios å‡½å¼å°±æ˜¯éåŒæ­¥çš„ã€‚

æˆ‘å€‘å¯ä»¥åˆ©ç”¨ Action ä¾†å°‡ Mutation æˆ–æ•¸å€‹ Mutation æ‰“åŒ…å•†æ¥­é‚è¼¯ã€‚

åœ¨æˆ‘å€‘å‰é¢ä»‹ç´¹ Vuex çš„èª²ç¨‹ä¸­ï¼Œåˆæ­¥äº†è§£åˆ° Action è¦å¦‚ä½•è¢«å¯«å…¥è¨­å®š `isLoading` state ç‚º true çš„ commit Mutationï¼Œç„¶å¾Œé€²è¡Œ API å‘¼å«ã€‚è€Œåœ¨ response å›å‚³æ™‚ï¼Œåœ¨ commit Mutation ä»¥ response è¨­å®š `todos` State ä¹‹å‰å…ˆ commit Mutation è¨­å®š`isLoading` State ç‚º falseã€‚

![](assets/Ch04/02.png)

ç†è§£ Action ä¸­çš„ Mutation ä¸ä¸€å®šæœƒè¢« commit æ˜¯å¾ˆé‡è¦çš„ï¼Œé€™å–æ±ºæ–¼å‘¨é‚Šé‚è¼¯å’Œç’°å¢ƒæ˜¯å¦‚ä½•åŸ·è¡Œçš„ã€‚

èˆ‰å€‹ç¾å¯¦ç”Ÿæ´»ä¸­çš„æ —å­ï¼Œå¦‚æœæˆ‘è«‹æˆ‘çš„æœ‹å‹å¾éºµåŒ…åº—å¹«æˆ‘å¸¶é»éºµåŒ…å›ä¾†ï¼Œé€™é‚Šçš„ Mutation æœƒæ˜¯ **PICK_UP_BREAD**ï¼Œè€Œ Action å·®ä¸å¤šæœƒæ˜¯ **pleasePickUpBread**ã€‚åœ¨è«‹æ±‚åˆ¥äººå»åšæŸä»¶äº‹å’Œä»–å€‘çœŸçš„æœƒå»åšä¹‹é–“æœ‰å¾ˆå¤§çš„å·®åˆ¥ã€‚

å¯ä»¥æœ‰å¾ˆå¤šç‚ºä»€éº¼ä»–ä¸èƒ½ commit Mutation çš„ç†ç”±ã€‚æ¯”å¦‚èªªä»–çš„è»Šå­åœ¨å»éºµåŒ…åº—çš„é€”ä¸­æ‹‹éŒ¨äº†ï¼Œæˆ–è€…æ˜¯éºµåŒ…åº—çš„éºµåŒ…è³£å®Œäº†ç­‰ç­‰...ã€‚æ‰€æœ‰ Action å°±å¥½åƒæ˜¯åœ¨è¡¨é”å°ç™¼ç”ŸæŸä»¶äº‹çš„æ„åœ–æˆ–æ…¾æœ›ï¼Œç‚ºäº†å° state åšå‡ºæŸç¨®æ”¹è®Šï¼Œæ˜¯å¦æœƒå®Œæˆé‚„è¦ä¾é å‘¨é‚Šç’°å¢ƒçš„é…åˆã€‚

ç¾åœ¨æˆ‘å€‘ä¾†çœ‹çœ‹ Action çš„å¯¦ä½œã€‚

## 

å›åˆ°è¨ˆæ•¸å™¨çš„æ —å­ï¼Œå¦‚æœæˆ‘å€‘åªæƒ³è¦åœ¨ app æœ‰ `user` çš„æ™‚å€™æ›´æ–° `count`ï¼Œå¯ä»¥åƒä¸‹é¢ğŸ‘‡é€™æ¨£å¯«ï¼š

```javascript
  actions: {
    updateCount({ state, commit }, incrementBy) {
      if (state.user) {
        commit('INCREMENT_COUNT', incrementBy)
      }
    }
  }
```

ä¸Šé¢ğŸ‘†çš„ç¨‹å¼ç¢¼åšäº†äº›ä»€éº¼å‘¢ï¼Ÿ

æˆ‘å€‘å»ºç«‹äº†ä¸€å€‹å« `updateCount` çš„ Actionã€‚å®ƒç”¨åˆ°äº†[ç‰©ä»¶è§£æ§‹](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment#Object_destructuring) çš„æ–¹å¼å¾ Vuex çš„æ¡†æ¶(context)ç‰©ä»¶ `{ state, commit }`å–å¾— `state` å’Œ `commit`ã€‚

é€™å€‹æ¡†æ¶ç‰©ä»¶æ˜¯ä»»ä½• Action çš„ç¬¬ä¸€å€‹å¼•æ•¸ï¼Œè€Œä¸”å®ƒå’Œåœ¨ store å¯¦é«”æ­éœ²çš„æ˜¯åŒä¸€çµ„å±¬æ€§ (state, mutations, actions, getters)ã€‚å› æ­¤ä½ å¯ä»¥è—‰ç”±å‘¼å« `context.commit` ä¾† commit ä¸€å€‹ mutation æˆ–è€…åƒæ˜¯ `context.state.count` ä¾†å–å¾— `count` State çš„å€¼ã€‚

å¦å¤–ï¼Œ`updateCount` æœƒå¸¶å…¥ `value` é€™å€‹é…¬è¼‰ã€‚

```javascript
  ({ state, commit }, value)
```

æ‰€è¬‚é…¬è¼‰å°±æ˜¯æ‰€æœ‰ Action çš„ç¬¬äºŒå€‹å¼•æ•¸ã€‚

æˆ‘å€‘é€™å€‹ Action æœƒæª¢æŸ¥ `user` æ˜¯ä¸æ˜¯å­˜åœ¨ State è£¡é¢ã€‚å¦‚æœæœ‰çš„è©±ï¼Œå°±æœƒ *commit* `INCREMENT_COUNT` é€™å€‹ Mutationï¼Œç„¶å¾ŒæŠŠ `incrementBy` çš„å€¼ç•¶ä½œé…¬è¼‰å‚³å…¥ã€‚å¦‚æœ `user` ä¸å­˜åœ¨ï¼Œå‰‡é€™å€‹ Mutation å°±ä¸æœƒè¢« commitã€‚

ç¾åœ¨åœ¨æˆ‘å€‘çš„çµ„ä»¶è£¡é¢ï¼Œæˆ‘å€‘å›ä¾† *dispatch* `updateCount` é€™å€‹ Actionï¼Œè€Œé€™å€‹ Action æœƒè¦–æ¢ä»¶ commit Mutationã€‚

```javascript
  incrementCount() {
    this.$store.dispatch('updateCount', this.incrementBy)
  },
```

å¾ˆé‡è¦è€Œä¸”ç‰¹åˆ¥è¦è¨˜ä½çš„æ˜¯ï¼Œå¼·çƒˆå»ºè­°**æ°¸é è¦å¾ Action è£¡é¢å» commit Mutaion**ã€‚å¦‚æœä½ çš„ Mutaion ç›®å‰ä¸éœ€è¦ä»»ä½•å•†æ¥­é‚è¼¯ï¼Œé€™æ¨£åšçœ‹èµ·ä¾†å¥½åƒæ˜¯åœ¨å¯«ä¸å¿…è¦çš„ç¨‹å¼ç¢¼ï¼Œä½†æ˜¯é€™æ¨£åšåœ¨æœªä¾†çµ•å°æœƒå°ä½ çš„ app çš„æ“´å……æ€§æ˜¯æ›´æœ‰å¹«åŠ©çš„ã€‚åœ¨ä¸€é–‹å§‹å°±é€™æ¨£å¯«çµ•å°æ¯”æœªä¾†æœ‰éœ€è¦çš„æ™‚å€™å†å¾ä½ çš„ app è£¡é¢é‡æ§‹ä¸€å †ç¨‹å¼ç°¡å–®çš„å¤šäº†ã€‚

ç¾åœ¨æˆ‘å€‘çŸ¥é“è¦æ€éº¼ commit Mutationï¼Œç„¶å¾ŒæŠŠå®ƒå€‘åŒ…åœ¨ Action è£¡é¢äº†ï¼Œé‚£éº¼å°±ä¾†æŠŠå®ƒæ”¾åˆ°æˆ‘å€‘çš„ç¯„ä¾‹ app å›‰ã€‚

## åŠ åˆ°ç¯„ä¾‹ App

ç›®å‰åœ¨æˆ‘å€‘çš„ app è£¡é¢ï¼Œåªæ˜¯å¾æ¨¡æ“¬ API æŠŠæ´»å‹•æŠ“ä¸‹ä¾†ã€‚ä½†æ˜¯æˆ‘å€‘é‚„å¸Œæœ›ä½¿ç”¨è€…èƒ½å¤ è‡ªå·±å»ºç«‹æ–°çš„æ´»å‹•ï¼Œé€™äº›æ´»å‹•æ˜¯è¢«æ–°å¢æˆ–æ˜¯èªªå„²å­˜åœ¨ Vuex store è£¡é¢ã€‚æ‰€æœ‰æˆ‘å€‘æœƒå¢åŠ ä¸€å€‹ Mutation ä¸¦ä¸”åœ¨ Action è£¡é¢ commit å®ƒã€‚

ä¸éé¦–å…ˆï¼Œæˆ‘å€‘è¦å…ˆä¾†å®‰è£æ–°çš„ç›¸ä¾å‡½å¼åº«ã€‚

## å®‰è£ Date Picker

æˆ‘å€‘å³å°‡å»ºç½®ä¸€å€‹ç”¨ä¾†å»ºç«‹æ–°æ´»å‹•çš„è¡¨å–®ã€‚ä½†æ˜¯æˆ‘å€‘éœ€è¦ä¸€å€‹çµ¦è¡¨å–®ä½¿ç”¨çš„æ—¥æœŸæŒ‘é¸å™¨ï¼Œæ‰€æœ‰æˆ‘å€‘å¯ä»¥ä¾†ä¸‹è¼‰ä¸€å€‹ç†±é–€çš„å¤–éƒ¨å‡½å¼ï¼š[vuejs-datepicker](https://github.com/charliekassel/vuejs-datepicker)ã€‚

å¾çµ‚ç«¯æ©Ÿçš„å‘½ä»¤åˆ—è¼¸å…¥ï¼š`npm install vuejs-datepicker --save` ä¾†å®‰è£ã€‚

å‡½å¼åº«è£å¥½å¾Œå°±å¯ä»¥åœ¨å°ˆæ¡ˆè£¡é¢ä½¿ç”¨å®ƒäº†ã€‚

## å»ºç«‹æ´»å‹•

è®“æˆ‘å€‘å›åˆ° **EventCreate** çµ„ä»¶ï¼Œå› ç‚ºå°±è·Ÿå®ƒçš„åå­—ä¸€æ¨£ï¼Œæˆ‘å€‘æœƒä½¿ç”¨å®ƒä¾†å»ºç«‹æ–°çš„æ´»å‹•ã€‚å°±è·Ÿæˆ‘å€‘ä¹‹å‰æœ‰ä¸€å€‹ input æ§åˆ¶é …ï¼Œç„¶å¾Œæˆ‘å€‘ç”¨ `v-model` æŠŠå®ƒçš„å€¼ç¶å®šåˆ° `data`ï¼Œç„¶å¾Œæœ‰å¦ä¸€å€‹ button æ§åˆ¶é …ä¾† commit Mutation ä¸€æ¨£ï¼Œæˆ‘å€‘æœƒç”¨æ¦‚å¿µç›¸åŒä½†æ›´å»¶ä¼¸çš„ç‰ˆæœ¬ä¾†è™•ç†ï¼Œåˆ©ç”¨ä¸€å€‹è¡¨å–®æ”¶é›†è³‡æ–™é€™æ¨£ä½¿ç”¨è€…å°±èƒ½å¤ å»ºç«‹æ–°çš„æ´»å‹•ã€‚

ä¸‹é¢ğŸ‘‡æ˜¯æˆ‘å€‘è¡¨å–®çš„æ¨£æ¿ï¼Œä½ å¯ä»¥æ³¨æ„åˆ°æˆ‘å€‘å·²ç¶“ä½¿ç”¨æ–°å¢çš„ `datepicker` å‡½å¼åº«äº†ã€‚

```html
        <form>
          <label>Select a category</label>
          <select v-model="event.category">
            <option v-for="cat in categories" :key="cat">{{ cat }}</option>
          </select>
          <h3>Name & describe your event</h3>
          <div class="field">
            <label>Title</label>
            <input v-model="event.title" type="text" placeholder="Add an event title"/>
          </div>
          <div class="field">
            <label>Description</label>
            <input v-model="event.description" type="text" placeholder="Add a description"/>
          </div>
          <h3>Where is your event?</h3>
          <div class="field">
            <label>Location</label>
            <input v-model="event.location" type="text" placeholder="Add a location"/>
          </div>
          <h3>When is your event?</h3>
          <div class="field">
            <label>Date</label>
            <datepicker v-model="event.date" placeholder="Select a date"/>
          </div>
          <div class="field">
            <label>Select a time</label>
            <select v-model="event.time">
              <option v-for="time in times" :key="time">{{ time }}</option>
            </select>
          </div>
          <input type="submit" class="button -fill-gradient" value="Submit"/>
        </form>
```

å¦‚ä½ æ‰€è¦‹ï¼Œæˆ‘å€‘è©¢å•ä½¿ç”¨é€™ä¸€ç³»åˆ—çš„å•é¡Œï¼Œç„¶å¾ŒæŠŠä»–çš„å›ç­”åœ¨ input æ§åˆ¶é …ä¸Šåˆ©ç”¨ `v-model` ç¶å®šåˆ°æˆ‘å€‘çš„ `data` å±¬æ€§ã€‚

è®“æˆ‘å€‘ä¸€èµ·ä¾†çœ‹çœ‹çµ„ä»¶çš„ `script` å»çœ‹ï¼Œç„¶å¾Œä¸€æ­¥æ­¥çš„è§£é‡‹ã€‚

```javascipt
  <script>
    import Datepicker from 'vuejs-datepicker'
    export default {
      components: {
        Datepicker
      },
      data() {
        const times = []
        for (let i=1; i<= 24; i++) {
          times.push(i + ':00')
        }
        return {
          event: this.createFreshEvent(),
          times,
          categories: this.$store.state.categories
        }
      },
      methods: {
        createFreshEvent() {
          const user = this.$store.state.user
          const id = Math.floor(Math.random() * 10000000)
          return {
            id: id,
            category: '',
            organizer: user,
            title: '',
            description: '',
            location: '',
            date: '',
            time: '',
            attendees: []
          }
        }
      }
    }
  </script>
```

ç¾åœ¨ä¾†æ‹†è§£é€™å¨ç¨‹å¼ç¢¼ã€‚

```javascript
  import Datepicker from 'vuejs-datepicker'
  export default {
    components: {
      Datepicker
    }
```

åœ¨ç¨‹å¼é ‚ç«¯ï¼Œæˆ‘å€‘åŒ¯å…¥æ–°çš„ `datepicker` å‡½å¼åº«ï¼Œä¸¦ä¸”å°‡å®ƒè¨»å†Šç‚ºå­çµ„ä»¶ï¼Œé€™æ¨£æˆ‘å€‘å°±å¯ä»¥åœ¨æ¨£æ¿è£¡é¢ä½¿ç”¨å®ƒã€‚

```javascript
  data() {
    const times = []
    for (let i = 1; i <= 24; i++) {
      times.push(i + ':00')
    }
    return {
      ...
      times
    }
```

æ¥è‘—åœ¨ `data` ä¸­ï¼Œæˆ‘å€‘ç”¨äº†é»ç°¡å–®æ¼”ç®—æ³•ä¾†ç”¢ç”Ÿæ™‚é–“çš„é™£åˆ—åˆ° `times` è£¡é¢ã€‚é€™é‚Šæ³¨æ„ä¸€ä¸‹ï¼Œ`data` è£¡é¢çš„ `times` å±¬æ€§å¯«æ³•å’Œ `{ times: times }` ç›¸åŒï¼Œå°±æ˜¯ç•¶ key è·Ÿ valve çš„åç¨±ä¸€æ¨£æ™‚å¯ä»¥ç°¡åŒ–æˆå‰é¢çš„å¯«æ³•ã€‚å¦‚æœä½ è¦ºå¾—é€™é‚Šçš„é‚è¼¯æ€ªæ€ªçš„ï¼Œè¨˜å¾— `data()` æ˜¯ä¸€å€‹å‡½å¼ï¼Œæ‰€ä»¥åœ¨è£¡é¢è™•ç†ä¸€ä¸‹è³‡æ–™åˆå§‹åŒ–çš„é‚è¼¯æ˜¯éå¸¸å¯è¡Œçš„ã€‚

```html
  <select v-model="event.time">
    <option v-for="time in times" :key="time">
      {{ time }}
    </option>
  </select>
```

åœ¨æ¨£æ¿é€™é‚Šæˆ‘å€‘åˆ©ç”¨ `v-for` ä¾†è·‘ä¸€é `times` é™£åˆ—ã€‚

ç¾åœ¨ä¾†çœ‹çœ‹å…¶é¤˜åœ¨ `data` è£¡é¢çš„å±¬æ€§ã€‚

```javascript
  return {
    event: this.createFreshEventObject(),
    categories: this.$store.state.categories,
    times
  }
```

åœ¨é€™é‚Šæˆ‘å€‘ç›´æ¥å¾ Vuex Store è£¡é¢ç²å– `categories` ç„¶å¾Œåœ¨ `option` å…ƒç´ ä¸Šåˆ©ç”¨ `v-for` è·‘éä¸€éæ‰€æœ‰ `categories` å…§å®¹ã€‚ä½†æ˜¯æˆ‘å€‘å° `event` åšäº†ä¸€ä»¶ç‰¹åˆ¥çš„äº‹ã€‚

```javascript
  event: this.createFreshEventObject(),
```

æˆ‘å€‘ä¸¦æ²’æœ‰ç›´æ¥åœ¨ `event` å±¬æ€§å¾Œé¢æ”¾ä¸€å€‹æ´»å‹•ç‰©ä»¶ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯æ¯ç•¶çµ„ä»¶è¢«å»ºç«‹æ™‚ï¼Œæˆ‘å€‘å‘¼å«ä¸€å€‹æœƒç”¢ç”Ÿæ–°æ´»å‹•çš„æ–¹æ³•ä¾†å–å¾—æ´»å‹•ç‰©ä»¶ã€‚

é€™å€‹æ–¹æ³•çœ‹èµ·ä¾†ä¸‹é¢ğŸ‘‡é€™æ¨£ï¼š

```javascript
  createFreshEventObject() {
    const user = this.$store.state.user
    const id = Math.floor(Math.random() * 10000000)
    return {
      id: id,
      category: '',
      organizer: user,
      title: '',
      description: '',
      location: '',
      date: '',
      time: '',
      attendees: []
    }
  }
```

åœ¨é€™å¡Šç¨‹å¼ç¢¼ä¸­ï¼Œæˆ‘å€‘å¾ Vuex Store å–å¾— `user`ï¼Œç„¶å¾Œå›å‚³ä¸€å€‹åŒ…å«æ‰€æœ‰æˆ‘å€‘æƒ³æ”¶é›†çš„è³‡æ–™çš„ç‰©ä»¶ï¼Œå…¶ä¸­åŒ…å«æˆ‘å€‘çš„ `user` stateã€‚æˆ‘å€‘ä¹Ÿå†ç”¨äº‚æ•¸å»ºäº†ä¸€å€‹ `id` å¸¸æ•¸ï¼Œç„¶å¾Œè¨­å®šçµ¦æ´»å‹•çš„ `id` å±¬æ€§ã€‚

é€™æ˜¯ä½ å¯èƒ½æœƒç–‘æƒ‘ï¼Œç‚ºä»€éº¼è¦ç”¨é€™å€‹æ–¹æ³•ä¾†å¾—åˆ°æ–°çš„æ´»å‹•ç‰©ä»¶ï¼Œç‚ºä»€éº¼ä¸è¦ç›´æ¥åœ¨ `data` è£¡é¢çš„åšéæ´»å‹•çš„å±¬æ€§ï¼Ÿå¾ˆå¥½ï¼Œå› ç‚ºåœ¨å»ºç«‹å®Œæ–°æ´»å‹•å¾Œæˆ‘å€‘è¦é‡ç½®çµ„ä»¶çš„æ´»å‹•è³‡æ–™ï¼Œåˆ©ç”¨é€™å€‹æ–¹æ³•å°±å¾ˆæ–¹ä¾¿ã€‚å¾…æœƒå¯ä»¥çœ‹åˆ°ä½¿ç”¨çš„æƒ…å½¢ã€‚

å‡å¦‚æˆ‘å€‘æ²’æœ‰é‡ç½®æœ¬åœ°çš„æ´»å‹•ç‰©ä»¶ï¼Œæˆ‘å€‘å¯èƒ½æœƒåœ¨é€™å€‹ç‰©ä»¶å’Œæ¨å› State çš„ç‰©ä»¶ä¹‹é–“ç•™ä¸‹ä¸å¿…è¦çš„é€£çµã€‚

>è‡ªå·±çš„ç†è§£ï¼š
>æ¯æ¬¡è¦æ±‚çš„æ™‚å€™å°±å»ºç«‹ä¸€å€‹å…¨æ–°çš„æ´»å‹•ç‰©ä»¶ï¼Œåœ¨ç®¡ç†ä¸Šçœå»å¾ˆå¤šä¸å¿…è¦çš„éº»ç…©

æœ€å¾Œæˆ‘å€‘åªéœ€å†åŠ ä¸Šç°¡å–®çš„ç¯„åœæ¨£å¼ï¼š

```css
  .field {
    margin-bottom: 24px;
  }
```

## ADD_EVENT Mutation

æˆ‘å€‘ç¾åœ¨è¦ä¾†åœ¨ Vuex Store åŠ å…¥ `ADD_EVENT` Mutationã€‚

```javascript
  ADD_EVENT(state, event) {
    state.events.push(event)
  }
```

é€™å€‹ Mutation æ¥å—ä¸€å€‹ `event` ç•¶ä½œå¼•æ•¸ç„¶å¾ŒæŠŠå®ƒæ¨åˆ° `events` é™£åˆ— state è£¡é¢ã€‚

## createEvent Action

æˆ‘å€‘ç¾åœ¨æƒ³æŠŠ `ADD_EVENT` Mutation åŒ…åˆ° `createEvent` é€™å€‹ Action è£¡é¢ã€‚
ä½†æ˜¯é¦–å…ˆéœ€è¦å…ˆåŒ¯å…¥ **EventService.js** æª”åˆ° **store.js** è£¡é¢ã€‚

```javascript
  import EventService from '@/services/EventService.js'
```

å› ç‚ºæˆ‘å€‘æœƒåœ¨ Action è£¡é¢ç”¨åˆ°å®ƒï¼š

```javascript
  createEvent({ commitm }, event) {
    EventService.postEvent(event)
    commit('ADD_EVENT', event)
  })
```

æ­£å¦‚ä½ æ‰€è¦‹ï¼Œæ–°å»ºç«‹çš„ Action åˆ©ç”¨äº† `EventService` é€²è¡Œ **POST** è«‹æ±‚ `postEvent(event)`ï¼Œåœ¨é€™å€‹ç¯„ä¾‹ app ä¸­ï¼Œå®ƒæœƒåœ¨ æœ¬åœ°çš„ `db.json` æª”æ–°å¢ä¸€å€‹æ´»å‹•ç‰©ä»¶ã€‚

ä¾†çœ‹çœ‹ **EventService** è£¡é¢é€™å€‹ **POST** è«‹æ±‚ï¼š

**EventService.js**

```javascript
  postEvent(event) {
    return apiClient.post('/events', event)
  }
```

é€™å€‹æ–¹æ³•æœƒæ¥æ”¶ä¸€å€‹æ´»å‹•ç•¶å¼•æ•¸ç„¶å¾Œ POST åˆ° API çš„ç«¯é»ä¾†æ¨¡æ“¬å¯«å…¥è³‡æ–™åº«ã€‚

ç„¶å¾Œ `createEvent` Action å°±æœƒ *commit* `ADD_EVENT` Mutationï¼Œé€™æ¨£å°±æœƒç«‹åˆ»æŠŠå‰›å‰›æ‰æ–°å¢åˆ°è³‡æ–™åº«çš„æ´»å‹•ä¹ŸåŠ å…¥æˆ‘å€‘æœ¬åœ°çš„ `events` Stateã€‚ä»¥é˜²å¾…æœƒ UI å°±æœƒç”¨åˆ°é€™å€‹å‰›æ–°å¢çš„ `event` stateã€‚

## Dispatch eventCreate Action

å›åˆ° **EventCreate** çµ„ä»¶ï¼Œæˆ‘å€‘ç¾åœ¨å¯ä»¥åœ¨è£¡é¢å¢åŠ ä¸€å€‹æ–°çš„æœƒ *dispatch* æ–°å»ºç«‹ Action çš„æ–¹æ³•ã€‚

```javascript
  methods: {
    createEvent() {
      this.$store.dispatch('createEvent', this.event)
    }
  }
```

æˆ‘å€‘æœƒåœ¨è¡¨å–®æäº¤æ™‚ç”¨ä¸‹é¢çš„æ–¹å¼ä¾†è§¸ç™¼é€™å€‹æ–¹æ³•ï¼š

```html
  <form @submit.prevent="createEvent">
```

## é‡ç½®æ´»å‹•è³‡æ–™

ä¹‹å‰æˆ‘å€‘æœ‰æåˆ°æœƒåœ¨æ¯æ¬¡æ–°æ´»å‹•æäº¤ä¹‹å¾Œé‡ç½®çµ„ä»¶çš„æ´»å‹•ç‰©ä»¶ï¼Œæˆ‘å€‘æœƒç”¨ä¸‹é¢é€™æ¨£çš„æ–¹å¼ä¾†åšï¼š

```javascript
  createEvent() {
    this.$store.dispatch('createEvent', this.event)
    this.event = this.createFreshEventObject()
  }
```

**å•é¡Œï¼š**åœ¨æˆ‘å€‘ç¢ºèªæ´»å‹•è¢«åŠ å…¥å¾Œç«¯ä¹‹å‰æˆ‘å€‘é‚„ä¸æƒ³æ¸…é™¤æ´»å‹•è³‡æ–™ã€‚å¦‚æœä½¿ç”¨è€…å»ºç«‹ä¸€å€‹æ–°æ´»å‹•ï¼Œé»æ“Šæäº¤ç„¶å¾Œèµ°é€²é›»æ¢¯çµæœé€™å€‹æ´»å‹•å°±æäº¤ä¸åˆ°å¾Œç«¯ã€‚é€™æ¨£ä»–å€‘å°±è¦æ•´å€‹é‡æ–°å»ºç«‹ä¸€éï¼Œå› ç‚ºæ´»å‹•å·²ç¶“è¢«é‡ç½®äº†ã€‚

**è§£æ³•ï¼š**åœ¨æˆ‘å€‘çš„ Action è£¡é¢ï¼Œæˆ‘å€‘å¯ä»¥å¾ API `return` responseã€‚æ¥è‘—åœ¨ `.then` commit Mutationã€‚

```javascript
  createEvent({ commit }, event) {
    return EventService.postEvent(event).then( () => {
      commit('ADD_EVENT', event.data)
    })
  }
```

æ”¹æˆé€™æ¨£ä¹‹å¾Œï¼Œç•¶æ´»å‹•ç‰©ä»¶æˆåŠŸ POST åˆ° API æ™‚ï¼Œæˆ‘å€‘å†ä¾† *commit* `ADD_EVENT`ã€‚è€Œä¸”æˆ‘å€‘ç”šè‡³å¯ä»¥ç­‰ response å›å‚³åˆ° **EventCreate** çµ„ä»¶ï¼Œå°±åƒä¸‹é¢çš„ç¨‹å¼ç¢¼ï¼š

```javascript
  createEvent() {
    this.$store.dispatch('createEvent', this.event)
    .then(() => {
      this.event = this.createFreshEventObject()
      })
      .catch(() => {
        console.log('There was a problem creating your event.')
      })
  }
```

ğŸ‘†çš„ç¨‹å¼ç¢¼ä¾†çœ‹ï¼Œæˆ‘å€‘ä¾¿åªæœƒåœ¨æ´»å‹•è³‡æ–™(`this.event`)æˆåŠŸ POST å¾Œæ‰é‡ç½®ã€‚

å¦‚æœ POST å¤±æ•—ï¼Œä¹ŸæœƒæŠŠéŒ¯èª¤ log åˆ° consoleã€‚åœ¨å¾Œé¢çš„ç« ç¯€æœƒå†èªªæ˜è¦æ€æ¨£æœ‰æ•ˆçš„æŠŠéŒ¯èª¤é¡¯ç¤ºçµ¦ä½¿ç”¨è€…çœ‹ã€‚

## è·¯ç”±åˆ°æ–°å»ºç«‹çš„æ´»å‹•é é¢

ä¸€æ—¦æˆ‘å€‘æˆåŠŸå»ºç«‹æ–°çš„æ´»å‹•å¾Œï¼Œæ¥ä¸‹ä¾†å°±æœƒæƒ³çœ‹çœ‹æˆ‘å€‘æ–°å¢çš„æ´»å‹•å…§å®¹ã€‚æ›å¥è©±èªªå°±æ˜¯æŠŠé é¢å°åˆ° **event-show** é é¢ä¾†çœ‹çœ‹æˆ‘å€‘å‰›å‰›æ–°å¢å¥½çš„æ´»å‹•ã€‚

æˆ‘å€‘å¯ä»¥ä½¿ç”¨ [router.push](https://router.vuejs.org/guide/essentials/navigation.html#router-push-location-oncomplete-onabort) æ–¹æ³•ä¾†å®Œæˆé€™å€‹åŠŸèƒ½ï¼Œç„¶å¾Œå°‡ `id` åƒæ•¸è¨­å®šç‚ºæˆ‘å€‘å‰›å‰›å»ºç«‹å¥½ `this.event` çš„ idã€‚

```javascript
  createEvent() {
    this.$store
      .dispatch('createEvent', this.event)
      .then(() => {
        this.$router.push({
          name: 'event-show',
          params: { id: this.event.id }
        })
        this.event = this.createFreshEventObject()
      })
      .catch(() => {
        console.log('There was a problem creating your event.'
      })
  }
```

æˆ‘å€‘åªéœ€è¦ç¢ºå®šåœ¨é™¤å» `id` **ä¹‹å¾Œ**å»å°è·¯ç”±åƒæ•¸é‡ç½®æ´»å‹•ï¼Œè¨˜ä½æ˜¯**ä¹‹å¾Œ**ï¼Œå¦å‰‡ `this.event` å°±æœƒè®Šæˆ `undefined`ã€‚

## èª¿æ•´ EventShow

ç¾åœ¨æˆ‘å€‘åªéœ€è¦èª¿æ•´ **EventShow** çµ„ä»¶çš„æ¨£æ¿ï¼Œè®“å®ƒä¸æœƒåœ¨æ´»å‹•ç­–åŠƒäººæ¬„ä½ä¸­é¡¯ç¤ºæ•´å€‹ä½¿ç”¨è€…ç‰©ä»¶ã€‚

ç¾åœ¨æˆ‘å€‘è¦ä½¿ç”¨ `.` è¡¨ç¤ºæ³•ä¾†é¡¯ç¤º `event.organizer.name` ç„¶å¾Œç”¨ä¸‰å…ƒé‹ç®—å­ä¾†é¿å…åœ¨çµ„ä»¶å–å¾—è³‡æ–™å‰å°±é€²è¡Œæ¸²æŸ“è€Œé€ æˆ `name is undefined` çš„éŒ¯èª¤ã€‚

```html
  <spam class="badge -fill-gradient">{{ event.attendees ? event.attendees.length : 0 }}</span>
```

æˆ‘å€‘ä¾†é¡¯ç¤ºæ´»å‹•ç­–åŠƒäººçš„åå­—ï¼š

```html
  <h5>
    Organized by {{ event.organizer ? event.organizer.name : '' }}
  </h5>
```

## ä¸‹ä¸€æ­¥æ˜¯ï¼Ÿ

æ¥ä¸‹ä¾†æˆ‘å€‘æœƒç¹¼çºŒå­¸ç¿’æœ‰é—œ Mutation å’Œ Actionï¼Œä»¥åŠè¦æ€éº¼æœ‰æ•ˆç‡çš„ç”¨å®ƒä¾†å¾ API æŠ“å–æ´»å‹•è³‡æ–™ã€‚









































