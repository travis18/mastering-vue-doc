<link rel="stylesheet" href="assets/style.css" type="text/css" />
# Mutation èˆ‡ Action - å–®å…ƒäºŒ

åœ¨[ä¸Šä¸€å€‹ç« ç¯€](4.-mutations-and-actions-pt1.md)æˆ‘å€‘å­¸åˆ°äº†è¦å¦‚ä½•æ­é… API é–‹å§‹å»ºç«‹ Vuex Action åŠ Mutationï¼Œåƒé€™æ¨£çš„æƒ…æ³åœ¨å¯¦éš›é–‹ç™¼æ‡‰ç”¨ç¨‹å¼æ™‚æ˜¯å¸¸å¸¸æœƒç™¼ç”Ÿçš„ã€‚åœ¨é€™å€‹ç« ç¯€æˆ‘å€‘å°‡æœƒç‚ºæˆ‘å€‘çš„ **EventList** å’Œ **EventShow** é é¢å»ºç«‹ Vuex Action åŠ Mutationï¼Œé€²è€Œå†å¯¦ä½œåˆ†é çš„åŠŸèƒ½ã€‚

## ğŸ›‘ å•é¡Œï¼šä½¿ç”¨ Vuex è¼‰å…¥ EventList

æˆ‘å€‘åœ¨ä¹‹å‰ä½¿ç”¨ Axios å»ºç«‹äº† **EventService**ï¼Œå…¶ä¸­æœ‰ä¸€å€‹ `getEvents` çš„æ–¹æ³•ï¼Œåœ¨ **EventList** çµ„ä»¶å»ºç«‹èµ·ä¾†çš„æ™‚å€™æˆ‘å€‘åˆ©ç”¨å®ƒä¾†å–å¾—æ´»å‹•å…§å®¹ã€‚é€™å€‹çµ„ä»¶ç¾åœ¨çœ‹èµ·ä¾†åƒé€™æ¨£ğŸ‘‡ï¼š

ğŸ“ƒ **/views/EventList.vue**

```vue
  <template>
    <div>
      <h1>Events Listing</h1>
      <EventCard v-for="event in events"
                 :key="event.id"
                 :event="event" />
    </div>
  </template>
  <script>
    import EventCard from '@/components/EventCard.vue'
    import EventService from '@/services/EventService.js'
    
    export default {
      components: {
        EventCard
      },
      data() {
        return {
          events: []
        }
      },
      created() {
        EventService.getEvents()
          .then(response => {
            this.events = response.data
          })
          .catch(error => {
            console.log('There was an error:', error.response)
          })
      }
    }
  </script>
```

ç„¶å¾Œåœ¨ç€è¦½å™¨çœ‹èµ·ä¾†æœƒæ˜¯é€™æ¨£ï¼š

![](assets/Ch05/01.jpg)

æˆ‘å€‘æƒ³è¦é€™æ¨£çš„çµ„ä»¶èƒ½å¤ é©ç•¶åœ°åˆ©ç”¨ Vuex ä¾†æ“·å–åŠé¡¯ç¤ºæ´»å‹•ã€‚

## â˜‘ï¸ è§£æ±ºæ–¹æ¡ˆ

åœ¨é€™å€‹çµ„ä»¶ä½¿ç”¨ Vuex çš„ç¬¬ä¸€æ­¥å°±æ˜¯å»ºç«‹æ–°çš„ Mutation å’Œ Actionã€‚ä¸‹é¢æ˜¯å±•ç¤ºæˆ‘å€‘æƒ³åœ¨ **EventList** çµ„ä»¶è£¡é¢ç™¼ç”Ÿçš„æµç¨‹ğŸ‘‡ï¼š

![](assets/Ch05/02.jpg)

åœ¨ Vuex State è£¡é¢æˆ‘å€‘å·²ç¶“æœ‰äº† `events:[]` é€™å€‹ Stateï¼Œè€Œä¸”æˆ‘å€‘ä¹Ÿå·²ç¶“åŒ¯å…¥ **EventService**ï¼Œæ‰€æœ‰ç¾åœ¨ **store.js** è£¡é¢æœƒè®Šæˆé€™æ¨£ğŸ‘‡ï¼š

ğŸ“ƒ **/store.js**

```javascript
  state: {
    ...
    events: [] // å·²ç¶“å­˜åœ¨äº†
  },
  mutations: {
    ...
    SET_EVENTS(state, events) {
      state.events = events
    }
  },
  actions: {
    ...
    fetchEvents({ commit }) {
      EventService.getEvents()
        .then(response => {
          commit('SET_EVENTS', response.data
        })
        .catch(error => {
          console.log('There was an error:', error.response)
        })
    }
  }
```

è«‹æ³¨æ„ï¼Œæˆ‘å€‘çš„ `SET_EVENTS` Mutation è¨­å®šå…¨éƒ¨çš„æ´»å‹•ï¼Œè€Œ `fetchEvents` Action å‰‡æ˜¯ç°¡å–®çš„å‘¼å« EventService ç„¶å¾Œå†å‘¼å« Mutationã€‚

å†å›åˆ°æˆ‘å€‘çš„ **EventList.vue** çµ„ä»¶ï¼Œæˆ‘å€‘æœƒåœ¨è£¡é¢åšä¸€ç±®ç­çš„å°ä¿®æ”¹ã€‚

ğŸ“ƒ **/views/EventList.vue**

```vue
  <script>
    import EventCard from '@/components/EventCard.vue'
    import { mapState } from 'vuex'
    
    export default {
      components: {
        EventCard
      },
      created() {
        this.$store.dispatch('fetchEvents')
      },
      computed: mapState(['events'])
    }
  </script>
```

ğŸ‘†é€™é‚ŠåŒ¯å…¥äº† `mapState` å°å¹«æ‰‹ï¼Œç„¶å¾Œç§»é™¤åŒ¯å…¥ EventService é‚£ä¸€è¡Œä»¥åŠ `data` å±¬æ€§æ˜¯ã€‚æˆ‘å€‘çš„ `created` ç”Ÿå‘½é€±æœŸé‰¤å­(lifecycle hook)å‘¼å«æ–°å»ºå¥½çš„ Actionã€‚ç¾åœ¨å›åˆ°ç€è¦½å™¨çœ‹çš„è©±ï¼Œå¯ä»¥çœ‹åˆ°æ´»å‹•åˆ—è¡¨ï¼Œå°±è·Ÿé‚„æ²’æ›´æ”¹ä¹‹å‰çœ‹èµ·ä¾†ä¸€æ¨£ã€‚

## ğŸ›‘ å•é¡Œï¼šåˆ†é 

åœ¨ app ä¸­é¡¯ç¤ºåˆ—è¡¨è³‡æ–™æ™‚ï¼Œåƒæ˜¯é€™é‚Šçš„æ´»å‹•åˆ—è¡¨ï¼Œæˆ‘å€‘å¸¸å¸¸æœƒæœ‰å¯èƒ½æœ‰åƒç™¾ç­†çš„æ´»å‹•è¦é¡¯ç¤ºï¼Œåƒé€™æ¨£çš„æƒ…å½¢è¦ä¸€æ¬¡å…¨æŠ“ä¸‹ä¾†çš„è©±å¯èƒ½æœƒæœ‰é»å•é¡Œï¼ˆè³‡æ–™é‡å¤ªå¤§è€Œä¸”å¯èƒ½å°è‡´æ‹–æ…¢ç€è¦½å™¨çš„é€Ÿåº¦ï¼‰ã€‚å› æ­¤æˆ‘å€‘éœ€è¦åƒæ˜¯ Google æœå°‹çµæœé‚£æ¨£çš„åˆ†é åŠŸèƒ½ã€‚å› ç‚ºæˆ‘å€‘æ‰“ç®—æ‰“é€ çš„æ˜¯çœŸå¯¦ä¸–ç•Œçš„æ‡‰ç”¨ç¨‹å¼ï¼Œæ‰€æœ‰è®“æˆ‘å€‘ä¾†è©¦è©¦çœ‹å¯¦ä½œåˆ†é åŠŸèƒ½å§ã€‚

## â˜‘ï¸ è§£æ±ºæ–¹æ¡ˆ

é¦–å…ˆè¦æ³¨æ„åˆ°çš„åœ°æ–¹æ˜¯å…¶å¯¦æˆ‘å€‘å¯é çš„ `json-server` å…¶å¯¦å·²ç¶“å…§å»º [API åˆ†é åŠŸèƒ½](https://github.com/typicode/json-server#paginate)ã€‚åŠ å…¥æˆ‘å€‘é€å‡º `_limit` åƒæ•¸å°±å¯ä»¥é™åˆ¶æ¯é å›å‚³çš„æ´»å‹•ç­†æ•¸ï¼Œå†åŠ ä¸Š `_page` åƒæ•¸å°±æœƒåªå›å‚³æŒ‡å®šé é¢çš„è³‡æ–™ã€‚æ˜¯ä¸æ˜¯å¾ˆå®Œç¾ï¼ğŸ‘

æ‰€ä»¥å¦‚æœæˆ‘å€‘å˜—è©¦å»ºæ§‹åƒæ˜¯ `/events?_limits=3&_page=2` çš„ URLï¼Œæˆ‘å€‘çš„ API å°±æœƒå›å‚³æ¯é  3 ç­†æ´»å‹•è³‡æ–™ï¼Œè€Œä¸”æ˜¯ç¬¬äºŒé çš„è³‡æ–™ã€‚é¦–å…ˆè®“æˆ‘å€‘å…ˆä¾†ä¿®æ”¹ **EventService** çš„ `getEvents` æ–¹æ³•ï¼Œå¢åŠ å…©å€‹æ–°çš„å‚³å…¥å¼•æ•¸ã€‚

ğŸ“ƒ **/services/EventService.js**

```javascript
  getEvents(perPage, page) {
    return apiClient.get('/events?_limit=' + perPage + '&_page=' + page)
  }
```

ç„¶å¾Œåœ¨ Vuexï¼Œå†æ”¹ä¸€ä¸‹ Actionï¼š

ğŸ“ƒ **/store.js**

```javascript
  actions: {
    ...
    fetchEvents({ commit }, { perPage, page }) {
      EventService.getEvents(perPage, page)
        .then(response => {
          commit('SET_EVENTS', response.data)
        })
        .catch(error => {
          console.log('There was an error:' + error.response)
        })
    }
  }
```

ğŸ‘†æ³¨æ„æˆ‘å€‘ `fetchEvents` Action çš„ç¬¬äºŒå€‹å¼•æ•¸æ˜¯ç”¨ ES2015 çš„[è§£æ§‹è³¦å€¼](https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment)æŠ“å‡º `{perPAge, page }`ã€‚å› ç‚º Mutation å’Œ Action çš„ç¬¬äºŒå€‹å¼•æ•¸éƒ½æ˜¯æœ‰æ•ˆçš„ `payload`é…¬è¼‰ã€‚è€Œé€™å€‹ `payload` å¯ä»¥æ˜¯å–®ä¸€çš„è®Šæ•¸æˆ–æ˜¯å–®ä¸€çš„ç‰©ä»¶ã€‚

é‚£éº¼ï¼Œè¦å¾ **EventList.vue** å‘¼å«å®ƒçš„è©±ï¼Œæˆ‘å€‘è¦é€™æ¨£åšğŸ‘‡ï¼š

```vue
  ...
  <script>
    import EventCard from '@/components/EventCard.vue'
    import { mapState } from 'vuex'
    
    export default {
      components: {
        EventCard
      },
      created() {
        this.$store.dispatch('fetchEvents', {
          perPage: 3, // <-- æ¯é è¦é¡¯ç¤ºå¤šå°‘æ´»å‹•
          page: this.page // <-- æˆ‘å€‘è¦ç€è¦½ç¬¬å¹¾é 
        })
      },
      computed: {
        page() { // æˆ‘å€‘ç¾åœ¨åœ¨ç¬¬å¹¾é 
          return parseInt(this.$route.query.page) || 1
        },
        ...mapState(['events'])
      }
    }
  </script>
```

é€™é‚Šè¦æ³¨æ„æˆ‘å€‘å»ºç«‹äº†ä¸€å€‹æ–°çš„ `computed` å±¬æ€§ï¼Œ`page()`ã€‚å®ƒæœƒé€²åˆ°ç›®å‰çš„ URLï¼Œæª¢æŸ¥æˆ‘å€‘æ˜¯ä¸æ˜¯æœ‰å€‹å« page çš„åƒæ•¸ï¼Œå¦‚æœæ²’æœ‰çš„è©±å°±å‡è¨­æˆ‘å€‘ç¾åœ¨åœ¨ç¬¬ä¸€é ã€‚æ‰€ä»¥åŠ å…¥ç›®å‰çš„ URL æ˜¯ï¼š`http://localhost:8080/?page=2` ç„¶å¾Œ `this.$route.query.page` å°±æœƒæ˜¯ `2`ã€‚æˆ‘å€‘åœ¨ `page`ä¸Šçš„æŸ¥è©¢åƒæ•¸å‘¼å« `parseInt` ä»¥ç¢ºä¿è³‡æ–™æ˜¯æ•¸å­—æ ¼å¼ã€‚

æ³¨æ„åˆ°æˆ‘å€‘çµ¦ Action çš„é…¬è¼‰æ˜¯ `{ perPage: 3, page: this.page }`ã€‚

æœ€å¾Œï¼Œæˆ‘å€‘ä¾†åœ¨ç›¸åŒçš„æª”æ¡ˆæ¨£æ¿ğŸ‘‡

ğŸ“ƒ **/views/EventList.vue**

```vue
  <template>
    <div>
      <EventCard 
        v-for="event in events" 
        :key="event.id"
        :event="event" />
      <template v-if="page != 1">
        <router-link
          :to="{ name: 'event-list', query: { page: page - 1 } }"
          rel="prev">Prev Page</router-link>
      </template>
      <router-link
        :to="{ name: 'event-list', query: { page: page + 1 } }">Next Page</router-link>
    </div>
  </template>
```

æ¨£æ¿é€™é‚ŠåŠ å…¥äº†åˆ†é çš„é€£çµï¼Œæˆ‘å€‘å¯ä»¥åœ¨ **db.json** å¢åŠ å¤šä¸€é»è³‡æ–™ä¾†è©¦è©¦çœ‹åˆ†é æ•ˆæœï¼ŒåƒğŸ‘‡é€™æ¨£ï¼š

![](assets/Ch05/03.gif)

çœ‹èµ·ä¾†åœ¨ç¬¬ä¸€é æˆ‘å€‘çœ‹åˆ°é é¢åªé¡¯ç¤ºæˆ‘å€‘è¨­å®šçš„ç­†æ•¸é™åˆ¶ã€‚çœ‹èµ·ä¾†å¥½åƒæˆåŠŸäº†ï¼Œä½†æ˜¯ä½†æˆ‘å€‘é€£åˆ°ä¸‹ä¸€é çš„æ™‚å€™ç•«é¢éƒ½æ²’è®Šï¼Œè¦é‡æ–°æ•´ç†ç•«é¢çš„æ™‚å€™æ‰æœƒæ›´æ–°ã€‚

## ğŸ›‘ å•é¡Œï¼šçµ„ä»¶æ²’æœ‰é‡æ–°è¼‰å…¥è³‡æ–™

é€™é‚Šçš„å•é¡Œåœ¨æ–¼ router èªç‚ºæˆ‘å€‘åœ¨è¼‰å…¥ç›¸åŒçš„ 'event-list' åç¨±è·¯ç”±ï¼Œæ‰€æœ‰ä¸æœƒé‡æ–°è¼‰å…¥çµ„ä»¶ã€‚é€™å°±åƒæ˜¯é»æ“Šå…©æ¬¡ç›¸åŒé€£çµä¸€æ¨£ï¼Œç•¶ä½¿ç”¨è€…é»æ“Šå…©æ¬¡ç›¸åŒé€£çµï¼Œè€Œä¸”ç€è¦½å™¨å·²ç¶“åœ¨é‚£å€‹é é¢ä¸Šæ™‚ï¼Œæˆ‘å€‘æœƒå¸Œæœ›é‡æ–°è¼‰å…¥çµ„ä»¶å—ï¼Ÿç­”æ¡ˆæ˜¯**ä¸æœƒ**ï¼Œæ‰€ä»¥æ‰æœƒæœ‰ç¾åœ¨é€™å€‹æƒ…å½¢ã€‚`created()` ä¸æœƒåœ¨é€£åˆ°ç¬¬äºŒé çš„æ™‚å€™å†æ¬¡è¢«å‘¼å«ï¼Œä¹Ÿæ˜¯å› ç‚ºçµ„ä»¶ä¸æœƒè¢«é‡æ–°è¼‰å…¥ã€‚

èº«ç‚ºä¸€å€‹ Vue é–‹ç™¼äººï¼Œé€™æ˜¯ç„¡å¯é¿å…çš„æƒ…å½¢ï¼šåœ¨æŸ¥è©¢åƒæ•¸æ”¹è®Šçš„æ™‚å€™é‡æ–°è¼‰å…¥çµ„ä»¶ã€‚

## â˜‘ï¸ è§£æ±ºæ–¹æ¡ˆï¼šæ›´æ–°è·¯ç”±è¦–åœ–

æœ‰å…©å€‹æ–¹å¼å¯ä»¥è§£æ±ºé€™å€‹å•é¡Œï¼š

1. ç›£çœ‹ `page` é€™å€‹ `computed` å±¬æ€§ï¼Œç•¶å®ƒçš„å€¼æ”¹è®Šæ™‚ dispatch `fetchEvent` é€™å€‹ actionã€‚
2. ç•¶*å®Œæ•´* URL ç™¼ç”Ÿæ”¹è®Šæ™‚ï¼Œå‘Šè¨´ `router` é‡æ–°è¼‰å…¥çµ„ä»¶ï¼Œæ‰€è¬‚å®Œæ•´ URL å°±åŒ…å«äº†è·Ÿåœ¨å¾Œé¢çš„æŸ¥è©¢åƒæ•¸ã€‚æˆ‘å€‘æœƒç”¨é€™å€‹è§£æ³•ï¼Œå› ç‚ºå®ƒè¶…ç°¡å–®ã€‚

ğŸ“ƒ **/App.vue**

```vue
  <template>
    <div id="app">
      <NavBar />
      <router-view :key="$route.fullPath" />
    </div>
  </template>
```

åœ¨ router-view åŠ ä¸Š key å±¬æ€§å¾Œï¼Œä¸€åˆ‡å°±è®Šå¾—æ­£å¸¸äº†ã€‚

![](assets/Ch05/04.gif)

## ğŸ“ é¡å¤–çå‹µ

åœ¨ç¾åœ¨çš„ç‰ˆæœ¬æˆ‘å€‘å¯ä»¥ç™¼ç¾ "Next Page" é€£çµä¸æœƒåœ¨æˆ‘å€‘ç€è¦½åˆ°æœ€å¾Œä¸€é çš„æ™‚å€™æ¶ˆå¤±ï¼Œæ‰€ä»¥é€ æˆæœƒé€£åˆ°ä¸€å€‹ç©ºç™½é é¢ï¼Œå¾ˆæ˜é¡¯çš„æˆ‘å€‘ä¸æƒ³ç™¼ç”Ÿé€™æ¨£çš„çµæœã€‚æ‰€ä»¥æˆ‘å€‘å¯ä»¥ä¾†å˜—è©¦è§£æ±ºé€™å€‹å•é¡Œï¼Œå°±ç•¶ä½œæ˜¯é¡å¤–çå‹µå§ï¼

æœ‰å¾ˆå¤šæ–¹å¼å¯ä»¥è§£æ±ºé€™å€‹å•é¡Œã€‚å¦‚æœæˆ‘å€‘çŸ¥é“ç¸½å…±æœ‰å¤šå°‘ç­†æ´»å‹•è³‡æ–™çš„è©±æœƒæ¯”è¼ƒç°¡å–®ã€‚**json-server** å…¶å¯¦åœ¨æ¯æ¬¡è«‹æ±‚è³‡æ–™çš„æ™‚å€™éƒ½æŠŠå®ƒæ”¾åœ¨ header ä¸Šé¢äº†ã€‚æˆ‘å€‘å¯ä»¥å¾ Chrome DevTools -> Network tab çœ‹åˆ°ä»–ï¼Œæˆ‘å€‘å¯ä»¥çœ‹åˆ°ï¼š

### x-total-count: 10

å°±æ˜¯å®ƒï¼çªç ´ç›²è…¸ã€‚æ‰€ä»¥æˆ‘å€‘å°±å¯ä»¥å¾ `fetchEvents` Action è£¡é¢å†ä¾†æŠ“é€™å€‹è³‡è¨Šã€‚

ğŸ“ƒ **/store.js**

```javascript
  fetchEvents({ commit }, { perPage, page }) {
    EventService.getEvents(perPage, page)
      .then( response => {
        console.log('Total events are ' + response.headers['x-total-count'])
        commit('SET_EVENTS', response.data)
  })
```

çœ‹åˆ° console.log çš„å…§å®¹äº†å—ï¼Ÿé€™é‚Šä½ å¯èƒ½æœƒæƒ³è¦å»ºç«‹ä¸€å€‹ `eventsTotal` çš„ Vuex Stateï¼Œç„¶å¾Œå†ç‚ºå®ƒå»ºç«‹ Mutation å’Œ Actionï¼Œå¾ `getEvents` è£¡é¢å‘¼å« Mutationï¼Œç„¶å¾Œå†å¾ `EventList.vue` æŠ“å‡ºä¾†æª¢æŸ¥ `eventsTotal > (this.page * 3)`ã€‚å¦‚æœç‚º true å°±é¡¯ç¤ºä¸‹ä¸€é ï¼Œé€™æ¨£ç†è§£ï¼Ÿ

## â¡ï¸ é—œæ–¼å¿«å–çš„å°ç­†è¨˜

æˆ‘å€‘ç¨‹å¼ç¾åœ¨é€™æ¨£çš„å¯«æ³•æœƒåœ¨æ¯å€‹é é¢å‘¼å« APIã€‚åœ¨æŸäº› appï¼Œæˆ‘å€‘å¯èƒ½æ°¸é æƒ³è¦å–å¾—æœ€æ–°çš„è³‡æ–™ï¼Œé€™ç¨®å¯«æ³•æ­£æ˜¯ç¬¦åˆé€™æ¨£çš„éœ€æ±‚ã€‚ä½†æ˜¯å¦‚æœæ˜¯è¦æ‡‰ä»˜å¹¾ç™¾è¬å€‹ä½¿ç”¨è€…çš„è©±ï¼Œæˆ‘å€‘æœ€å¥½è¦å¯¦ä½œæŸç¨®å¿«å–ç­–ç•¥ä¾†ä¿æŒæˆ‘å€‘é é¢çš„åæ‡‰é€Ÿåº¦ã€‚ä¸ç®¡å¾Vue çš„å¤–éƒ¨æˆ–å…§éƒ¨éƒ½æœ‰å¾ˆå¤šç¨®æ–¹å¼å¯ä»¥åšåˆ°ã€‚

## ğŸ›‘ å•é¡Œï¼šå¯¦ä½œæ´»å‹•é¡¯ç¤ºé é¢

ç¾åœ¨æˆ‘å€‘çš„åˆ†é åŠŸèƒ½å·²ç¶“å°±ä½äº†ï¼Œç•¶ä½¿ç”¨è€…é»æ“Šä¸€å€‹æ´»å‹•æœƒé€£åˆ°æ´»å‹•é¡¯(**ShowEvent**)ç¤ºé é¢ï¼Œåœ¨ Vuex è£¡é¢æˆ‘å€‘è¦åšä»€éº¼å‘¢ï¼Ÿé€™æ˜¯ç›®å‰é é¢çœ‹èµ·ä¾†çš„æ¨£å­ğŸ‘‡ï¼š

![](assets/Ch05/05.gif)

## â˜‘ï¸ è§£æ±ºæ–¹æ¡ˆ

å’Œä¹‹å‰ç›¸åŒï¼Œæˆ‘å€‘å…ˆå¾ Vuex é–‹å§‹ï¼Œé€™æ¬¡åœ¨ State è£¡é¢åŠ å…¥ä¸€å€‹å« `event` çš„ç‰©ä»¶ä¾†å„²å­˜ç›®å‰é¡¯ç¤ºçš„æ´»å‹•ã€‚ç„¶å¾Œåœ¨å¢åŠ ä¸€å€‹ Mutation ä¾†è¨­å®šå®ƒçš„å€¼ä»¥åŠä¸€å€‹ Action ä¾†å‘¼å« APIã€‚

ğŸ“ƒ **/store.js**

```javascript
  export default new Vuex.Store({
    state: {
      ...
      event: {}
    },
    mutations: {
      SET_EVENT(state, event) {
        state.event = event
      }
    },
    actions: {
      ...
      fetchEvent({ commit }, id) {
        EventService.getEvent(id)
          .then(response => {
            commit('SET_EVENT', response.data
          })
          .catch(error => {
            console.log('There was an error:', error.response)
          })
      }
    }
  })
```

ç„¶å¾Œåœ¨æˆ‘å€‘ **EventShow** çµ„ä»¶ï¼Œæˆ‘å€‘æœƒ dispatch `fetchEvent` Actionï¼Œç„¶å¾Œé€å‡º `id` ç•¶ä½œé…¬è¼‰ã€‚

ğŸ“ƒ **/views/EventShow.vue**

```vue
  ...
  <script>
    import { mapState } from 'vuex'
    
    export default {
      props: ['id'],
      created() {
        this.$store.dispatch('fetchEvent', this.id)
      },
      computed: mapState(['event'])
    }
  </script>
```

ğŸ‘†æ”¹æˆé€™æ¨£å°±è¡Œäº†ï½è€Œä¸” **EventShow** é é¢çœ‹èµ·ä¾†å’ŒåŸä¾†ä¸€æ¨£ï¼Œä½†æ˜¯å…§å®¹å·²ç¶“æ”¹æˆ Vuex å›‰ã€‚

## ğŸ›‘ å•é¡Œï¼šæˆ‘å€‘è¼‰å…¥äº†è³‡æ–™å…©æ¬¡å‘€ï¼

æˆ‘å€‘å‰›å¥½åœ¨ **EventList** é é¢è¼‰å…¥æ‰€æœ‰è¦é¡¯ç¤ºçš„æ´»å‹•è³‡æ–™ã€‚å¦‚æœæˆ‘å€‘å…ˆå»ç€è¦½ **EventList** é é¢ï¼Œç„¶å¾Œå†é»æ“Šæ´»å‹•é€²å…¥ **EventShow** é é¢(ä¸€èˆ¬ä¾†èªªå¾ˆå¤šä½¿ç”¨è€…éƒ½æœƒé€™éº¼åš)ï¼Œåœ¨æˆ‘å€‘æ‰‹ä¸Šå·²ç¶“æœ‰è³‡æ–™çš„æ™‚å€™å»é‚„è¦å†å»å‘¼å« API å–å¾—è³‡æ–™é€™æ¨£çœ‹èµ·ä¾†å¥½åƒå¾ˆæµªè²»è€¶ã€‚æˆ‘å€‘è©²æ€éº¼ç¯€çœåƒé€™æ¨£å¤šé¤˜çš„ API å‘¼å«å‘¢ï¼Ÿ

## â˜‘ï¸ è§£æ±ºæ–¹æ¡ˆ

ç•¶æˆ‘å€‘é€£åˆ° **ShowEvent** é é¢çš„æ™‚å€™ï¼Œæˆ‘å€‘éœ€è¦æª¢æŸ¥ `events` State é™£åˆ—æ˜¯ä¸æ˜¯å·²ç¶“æœ‰äº†é€™å€‹æ´»å‹•äº†ã€‚æˆ‘å€‘å¯ä»¥åˆ©ç”¨ **store.js** è£¡é¢å·²ç¶“æœ‰çš„ Getter ä¾†åšé€™ä»¶äº‹ã€‚æˆ‘å€‘å¯ä»¥åœ¨ `fetchEvent` Action è£¡é¢å‘¼å«å®ƒï¼Œåƒæ˜¯é€™æ¨£ğŸ‘‡ï¼š

ğŸ“ƒ **/store.js**

```javascript
  ...
  actions: {
    ...
    fetchEvent({ commit, getters }, id) {
    // é™¤äº† commit ï¼Œä¹Ÿå‚³å…¥ getters
      var event = getters.getEventById(id) // æª¢æŸ¥ state è£¡é¢æ˜¯ä¸æ˜¯å·²ç¶“æœ‰é€™å€‹æ´»å‹•äº†ã€‚
      
      if (event) { // æ‰¾åˆ°æ´»å‹•äº†ï¼Œcommit å®ƒ
        commit('SET_EVENT', event)
      } else { // æ²’æ‰¾åˆ°æ‰å‘¼å« API
        EventService.getEvent(id)
          .then(response => {
            commit('SET_EVENT', response.data
          })
          .catch(error => {
            console.log('There was an error:', error.response
          })
      }
    }
  },
  getters: {
    getEventById: state => id => {
      return state.events.find(event => event.id === id)
    }
  }
```

æ­£å¦‚ğŸ‘†çš„ç¨‹å¼ç¢¼ï¼Œåœ¨ Action çš„é–‹é ­æˆ‘å€‘å°±å‘¼å« `getters.getEventById(id)` å…¶ä¸­ `id` æ˜¯æˆ‘å€‘æƒ³é¡¯ç¤ºçš„æ´»å‹•ã€‚å¦‚æœå¾ç¾è¡Œ State æ‰¾å¾—åˆ°çš„è©±æˆ‘å€‘å°± commit Mutationï¼Œå¦å‰‡å†å»å¾ API æŠ“ã€‚

å¾ˆæ˜é¡¯åœ°ï¼Œå¦‚æœæˆ‘å€‘æƒ³è¦ç¢ºèªé¡¯ç¤ºçš„é é¢æ°¸é éƒ½æ˜¯æœ€æ–°çš„å…§å®¹ï¼Œæˆ‘å€‘æœƒæƒ³å³ä½¿ **EventList** çµ„ä»¶è£¡é¢å·²ç¶“æœ‰äº†é‚„æ˜¯è¦å»å‘¼å« APIã€‚

## âª æ‘˜è¦

æ•´ç†ä¸€ä¸‹åœ¨é€™å€‹ç« ç¯€æˆ‘å€‘å­¸åˆ°çš„é‡é»ï¼š

- å¦‚ä½•åœ¨ Vuex æŠ“å–å–®ä¸€æ´»å‹•æˆ–æ´»å‹•åˆ—è¡¨ã€‚
- å¦‚ä½•ç”¨ Vuex åšåˆ°åˆ†é åŠŸèƒ½ã€‚
- å¦‚ä½•åœ¨ router è£¡é¢ä½¿ç”¨æŸ¥è©¢åƒæ•¸ï¼Œç„¶å¾Œç¢ºä¿çµ„ä»¶åœ¨åƒæ•¸ä¿®æ”¹æ™‚é‚„æ˜¯æœƒé‡æ–°è¼‰å…¥ã€‚
- å¦‚ä½•æœ€ä½³åŒ– Vuex Stateï¼Œé¿å…é‡è¤‡è¼‰å…¥è³‡æ–™å…©æ¬¡ã€‚





























