<link rel="stylesheet" href="assets/style.css" type="text/css" />
# State èˆ‡ Getter

åœ¨é€™å€‹ç« ç¯€ä¸­æˆ‘å€‘å¯ä»¥å° Vuex å¦‚ä½•é‹ä½œæœ‰å€‹æ¦‚è§€ã€‚å¯ä»¥å­¸åˆ°è¦æ€éº¼å¾ Vuex storeï¼Œå¾çµ„ä»¶å­˜å– Stateï¼Œå…©è€…éƒ½ç›´æ¥è—‰ç”± **Getters** çš„å¹«å¿™ä¾†é”æˆã€‚

## å­˜å– State

æ‰“é–‹ **main.js** ä¾†çœ‹çœ‹ï¼Œå¯ä»¥åœ¨è£¡é¢ç™¼ç¾åŒ¯å…¥äº† Vuex çš„ **store** æª”ï¼Œä¸¦ä¸”å°‡å®ƒæä¾›çµ¦ Vue å¯¦é«”ã€‚é€™æ˜¯ç‚ºæˆ‘å€‘æ‰€è¨­å®šçš„ï¼Œå› ç‚ºæˆ‘å€‘åœ¨ä½¿ç”¨ Vue CLI å»ºç«‹å°ˆæ¡ˆæ™‚é¸æ“‡äº†å®‰è£ Vuexã€‚

```javascript
    import store from './store' 
    
    new Vue({
      router,
      store, // <-- injecting the store for global access
      render: h => h(App)
    }).$mount('#app')
```

é€™æ®µç¨‹å¼ç¢¼èƒ½å¤ è—‰ç”±æ³¨å…¥åˆ°æ¯å€‹çµ„ä»¶å°‡ **store** æˆç‚ºèƒ½åœ¨æˆ‘å€‘çš„ app ä¸­å…¨åŸŸå­˜å–çš„ç‰©ä»¶ã€‚å¦‚æ­¤ä¸€ä¾†ï¼Œä»»ä½•çµ„ä»¶éƒ½èƒ½è—‰ç”± `$store` å­˜å– **store** å’Œå…¶ä¸Šçš„å±¬æ€§(è«¸å¦‚ Stateï¼ŒActionsï¼ŒMutations ä»¥åŠ Getters)ã€‚

ç¾åœ¨è®“æˆ‘å€‘åŠ å…¥ä¸€äº› State ä¾†çœ‹çœ‹è¦æ€éº¼å¾çµ„ä»¶ä¸­å­˜å–ã€‚æˆ‘å€‘å¯ä»¥å»ºç«‹ä¸€å€‹ `user` ç‰©ä»¶ã€‚

```javascript
    state: {
      user: { id: 'abc123', name: 'Adam Jahr' }
    }
```

æˆ‘å€‘å¯ä»¥å¾ app çš„ä»»ä½•åœ°æ–¹å­˜å– `user` Stateï¼Œä½†å› ç‚ºå¾ˆå¿«æˆ‘å€‘å°±è¦ä¾†å»ºç«‹æ´»å‹•ï¼Œé‚£æ™‚å€™æœƒéœ€è¦çŸ¥é“æ˜¯å“ªå€‹ user å»ºç«‹çš„ï¼Œæ‰€ä»¥æˆ‘å€‘å°±å…ˆä¾†å¾ **EventCreate.vue** å­˜å– Stateã€‚

```javascript
    <template>
      <h1>Create Event, {{ $store.state.user }}</h1>
    </template>
```

é€™æ¨£å¯«æ˜¯å¯è¡Œçš„ï¼Œä½†è¦æ³¨æ„åœ¨ç€è¦½å™¨ä¸­æˆ‘å€‘å¦‚ä½•é¡¯ç¤ºæ•´å€‹ `user` ç‰©ä»¶ã€‚æˆ‘å€‘å¯ä»¥ç”¨ `.` è¡¨ç¤ºæ³•ä¾†å¾ `user` State æŒ‡å®šæƒ³è¦é¡¯ç¤ºçš„å±¬æ€§ã€‚ä»¥é€™å€‹ä¾‹å­ä¾†çœ‹æˆ‘å€‘åªæƒ³é¡¯ç¤º  `name` é€™å€‹å±¬æ€§ã€‚

![](assets/Ch03/01.png)

è®šï¼ç¾åœ¨æˆ‘å€‘å¯ä»¥çœ‹åˆ°ä½¿ç”¨è€…çš„åå­—ã€‚é‚£å¦‚æœæˆ‘å€‘æƒ³åœ¨çµ„ä»¶è£¡çš„å¤šå€‹åœ°æ–¹ç”¨åˆ°ä½¿ç”¨è€…çš„åå­—å‘¢ï¼Ÿç•¶ç„¶ï¼Œæˆ‘å€‘æœƒåœ¨æ‰€æœ‰çš„åœ°æ–¹å¯«æˆ `this.$store.state.user.name`... æˆ–è€…æ˜¯æˆ‘å€‘ä¹Ÿå¯ä»¥åªå¯«åœ¨ `computed` å±¬æ€§ä¸­ï¼Œæˆ‘å€‘æŠŠé€™å€‹å±¬æ€§å«åš `userName`ã€‚

```javascript
    computed: {
      userName() {
        return this.$store.state.user.name
      }
    }
```

é€™æ¨£å¯«æˆ‘å€‘çš„æ¨£æ¿çœ‹èµ·ä¾†æ›´ä¹¾æ·¨æ›´æ˜“è®€äº†ã€‚

```html
    <h1>Create an Event, {{ userName }}</h1>
    <p>This event is created by {{ userName }}</p>
```

è€Œä¸”å¦‚æœæˆ‘å€‘éœ€è¦åœ¨æˆ‘å€‘çš„çµ„ä»¶ä¸­çš„æ–¹æ³•è£¡é¢ç”¨åˆ°å®ƒæ™‚ï¼Œå°±å¯ä»¥å¾ˆç°¡å–®çš„å¯«æˆ `this.userName`ã€‚

## `mapState` å°å¹«æ‰‹(Helper)

å¦‚æœæˆ‘å€‘éœ€è¦åœ¨åŒä¸€å€‹çµ„ä»¶å­˜å– State çš„ä¸åŒéƒ¨åˆ†çš„è©±ï¼Œæƒ…æ³å¯èƒ½æœƒè®Šå¾—å¾ˆå†—é•·ï¼Œåˆè¦åè¦†çš„ç‚ºæ¯å€‹å±¬æ€§å¢åŠ  `computed` å±¬æ€§ã€‚ç‚ºäº†è¦ç°¡åŒ–é€™æ¨£çš„å·¥ä½œï¼Œæˆ‘å€‘å¯ä»¥åˆ©ç”¨ `mapState` å°å¹«æ‰‹çš„åŠŸèƒ½ï¼Œå®ƒå¯ä»¥ç‚ºæˆ‘å€‘ç”Ÿæˆ `computed` å±¬æ€§ã€‚

æˆ‘å€‘å…ˆä¾†å¢åŠ æ›´å¤šçš„ State åˆ° Vuex Store è£¡ï¼Œé€™æ¨£æ¯”è¼ƒå®¹æ˜“çœ‹å‡ºä¾†ã€‚å…ˆä¾†å¢åŠ ä¸€å€‹æ´»å‹•é¡å‹çš„é™£åˆ—ï¼š

```javascript
    state: {
      user: { id: 'abc123', name: 'Adam Jahr' },
      categories: ['sustainability', 'nature', 'animal welfare', 'housing', 'education', 'food', 'community']
    }
```

ç¾åœ¨åœ¨ **EventCreate.vue**ï¼Œæˆ‘å€‘ä¾† import `mapState`

```javascript
  import { mapState } from 'vuex'
```

ç„¶å¾Œä½¿ç”¨å®ƒä¾†å°‡ State æ˜ å°„åˆ° `computed` å±¬æ€§ï¼Œå¦‚æ­¤å°±å¯ä»¥å–å¾—ä½¿ç”¨è€…çš„ åå­—å’Œæ´»å‹•é¡åˆ¥ã€‚

```javascript
    computed: mapState({
      userName: state => state.user.name,
      categories: state => state.categories
    })
```

é€™é‚Šå¯ä»¥æ³¨æ„ä¸€ä¸‹æˆ‘å€‘æ˜¯æ€éº¼ä½¿ç”¨ç®­è™Ÿå‡½å¼å–å¾— `state` ç‰©ä»¶ä¸¦å›å‚³æƒ³è¦çš„å±¬æ€§ï¼Œ`state.user.name` ä»¥åŠ `state.categories`

å¦‚æœæˆ‘å€‘å­˜å–çš„æ˜¯æœ€ä¸Šå±¤çš„ Stateï¼ˆä¸ä½¿ç”¨`.`è¡¨ç¤ºæ³•å¾€ä¸‹å–å¾—å±¬æ€§ï¼‰ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨æ›´ç°¡åŒ–çš„å¯«æ³•ï¼Œå¦‚ä¸‹ï¼š

```javascript
    computed: mapState({
      userName: state => state.user.name,
      categories: 'categories' // <-- simplified syntax for top-level State
    })
```

é€™é‚Šå¯ä»¥å†æ³¨æ„ä¸€ä¸‹æˆ‘å€‘å¾—ç”¨å­—ä¸²çš„ `'categories'`ã€‚é€™å€‹å­—ä¸²çš„æ•ˆæœå°±å’Œ `state => state.categories` ç›¸åŒã€‚

æˆ‘å€‘é‚„å¯ä»¥æ›´é€²ä¸€æ­¥ç°¡åŒ– `mapState` çš„èªæ³•ï¼Œé‚£å°±æ˜¯ç›´æ¥å‚³ä¸€å€‹æˆ‘å€‘æƒ³è¦æ˜ å°„ State ç‰©ä»¶çš„å­—ä¸²é™£åˆ—ï¼Œåƒé€™æ¨£ï¼š

```javascript
  computed: mapState(['categories', 'user'])
```

ç•¶ç„¶å•¦ï¼Œåœ¨ç°¡åŒ– `mapState` å¯«æ³•ä¹‹å¾Œï¼Œæˆ‘å€‘çš„æ¨£æ¿è£¡é¢åªè¦ç”¨ `.` è¡¨ç¤ºæ³•å­˜å–ä½¿ç”¨è€…åå­—å°±å¯ä»¥äº†ã€‚

```html
  <h1>Create am Event, {{ user.name }}</h1>
```

## ç‰©ä»¶å»¶å±•é‹ç®—å­(Object Spread Operator)

ä½ ç¾åœ¨å¯èƒ½å·²ç¶“æ³¨æ„åˆ°äº†ï¼Œ`mapState` å›å‚³ä¸€å€‹æœ‰ **computed** å±¬æ€§çš„ç‰©ä»¶ã€‚ä½†æ˜¯é€™æ¨£æˆ‘å€‘å°±ç„¡æ³•å¢åŠ é¡å¤–çš„å±¬æ€§ï¼Œåƒæ˜¯æœ¬åœ°ä½¿ç”¨çš„ computed å±¬æ€§å°±ç„¡æ³•è¢«åŠ å…¥ã€‚

ç‚ºäº†è§£æ±ºé€™å€‹å•é¡Œæˆ‘å€‘å¯ä»¥åˆ©ç”¨*ç‰©ä»¶å»¶å±•é‹ç®—å­*ï¼Œå®ƒå…è¨±æˆ‘å€‘å°‡é¡å¤–çš„ computed å±¬æ€§æ··åˆé€²ä¾†ã€‚

```javascript
    computed: {
      localComputed() {
        return something
      },
      ...mapState(['categories', 'user']) // <-- using object spread operator
    }
``` 

## Getters

é›–ç„¶æˆ‘å€‘å¯ä»¥ç›´æ¥å­˜å– Store çš„ Stateï¼Œä½†æœ‰æ™‚æˆ‘å€‘é‚„æ˜¯æœƒæƒ³è¦å­˜å–å®ƒè¡ç”Ÿçš„ Stateã€‚æ›å¥è©±èªªå°±æ˜¯æˆ‘å€‘å¯èƒ½æƒ³è¦åœ¨å­˜å–æ™‚å†å° state *åŠ å·¥*ä¸€ä¸‹ã€‚

èˆ‰ä¾‹ä¾†èªªï¼Œæˆ‘å€‘å¯èƒ½æƒ³è¦çŸ¥é“æœ‰å¤šå°‘ `categories` è€Œä¸æ˜¯å­˜å– `categories` é€™å€‹ Stateã€‚ä¹Ÿå°±æ˜¯èªªæˆ‘å€‘å¯èƒ½æƒ³è¦çŸ¥é“ `categories` é™£åˆ—çš„é•·åº¦ã€‚

å¾çµ„ä»¶è£¡é¢æˆ‘å€‘å¯ä»¥é€™æ¨£å¯«ï¼š

```javascript
  this.$store.state.categories.length
```

é‚£å¦‚æœèªªæœ‰å¤šå€‹çµ„ä»¶éƒ½éœ€è¦å–å¾—é€™å€‹æ•¸å€¼å‘¢ï¼Ÿè—‰ç”±å»ºç«‹ Vuex çš„ Getterï¼Œæˆ‘å€‘å°±å¯ä»¥é¿å…ä¸å¿…è¦çš„é‡è¤‡ç¨‹å¼ç¢¼ã€‚è€Œä¸”åŒæ¨£çš„é“ç†ï¼Œå› ç‚º Getter æœƒè¢«å¿«å–ï¼Œæ‰€ä»¥ä½¿ç”¨å®ƒä¹Ÿå¯ä»¥æ˜¯æ›´æœ‰æ•ˆèƒ½çš„é¸é …ä¹‹ä¸€ã€‚

æˆ‘å€‘ä¾†è©¦è©¦çœ‹æŠŠ Getter åŠ åˆ° Store è£¡é¢ã€‚

**store.js**

```javascript
  catLength: state => {
    return state.categories.length
  }
```

å¾ä¸Šé¢çš„ç¨‹å¼ç¢¼æˆ‘å€‘å¯ä»¥äº†è§£ï¼ŒGetter éƒ½æ˜¯å¸¶å…¥ `state` ç•¶ä½œåƒæ•¸çš„å‡½å¼ï¼Œä¸¦ä¸”å…è¨±å›å‚³åŠ å·¥æˆ–ç¯©é¸éçš„ stateã€‚

------------------

### ä½¿ç”¨ Getter

ç¾åœ¨æˆ‘å€‘ä¾†æŠŠ `catLength` é€™å€‹ Getter ç”¨åœ¨æˆ‘å€‘çš„ **EventCreate** çµ„ä»¶ä¸­ã€‚å°±å’Œå­˜å– State çš„æ–¹æ³•ä¸€æ¨£ï¼Œæˆ‘å€‘æœƒæŠŠå®ƒæ”¾åœ¨ `computed` çš„å±¬æ€§è£¡é¢ã€‚

```javascript
  computed: {
    catLength() {
      return this.$store.getters.catLength
    }
  }
```

å¦‚æœåœ¨ä»»ä½•æ™‚é–“é»ï¼Œ`categories` State é™£åˆ—çš„é•·åº¦æ”¹è®Šçš„æ™‚å€™ï¼Œ`catLength` Getter æœƒè¢«é‡æ–°è¨ˆç®—ï¼Œæˆ‘å€‘çš„ `computed` å±¬æ€§å…§å®¹ä¹Ÿå°±è·Ÿè‘—æ›´æ–°äº†ã€‚

---------------------

### å‚³é Getter åˆ° Getter

å¦‚æœæˆ‘å€‘æƒ³è¦å–å¾—çš„ state æ˜¯è¦è·Ÿå¦ä¸€å€‹ Getter ä¸€èµ·åŠ å·¥æ‰èƒ½å¾—åˆ°çš„è©±ï¼Œæˆ‘å€‘å¯ä»¥å‚³å…¥ `getters` ç•¶ä½œ Getter çš„ç¬¬äºŒå€‹åƒæ•¸ã€‚é€™æ¨£æˆ‘å€‘å°±å¯ä»¥åœ¨é€™å€‹ Getter è£¡é¢å­˜å–å…¶ä»– Getter çš„å…§å®¹ã€‚

èˆ‰å€‹ç°¡å–®çš„æ —å­ï¼Œå¥½æ¯”èªªåœ¨ State ä¸­æˆ‘å€‘æœ‰å€‹ todos çš„é™£åˆ—ï¼š

```javascript
    todos: [
          { id: 1, text: '...', done: true },
          { id: 2, text: '...', done: false },
          { id: 3, text: '...', done: true },
          { id: 4, text: '...', done: false }
        ]
```

æˆ‘å€‘å¯èƒ½æœƒå»ºç«‹ä¸€å€‹ Getter å»å–å¾—é‚£äº›æ¨™ç¤ºç‚º `done` çš„ todoã€‚

```javascript
  doneTodos: (state) => {
    return state.todos.filter(todo => todo.done)
  }
```

ç„¶å¾Œå¦‚æœåœ¨æˆ‘å€‘æƒ³æ‰¾å‡ºé‚„æœ‰å¤šå°‘å¾…å®Œæˆçš„ todoæ™‚ï¼Œæˆ‘å€‘å°±å¯ä»¥åœ¨å¦ä¸€å€‹ Getter ä¸­ä½¿ç”¨ `doneTodos` é€™å€‹ Getterã€‚

```javascript
  activeTodosCount: (state, getters) => {
    return state.todos.length - getters.doneTodos.length
  }
```

é€™æ¨£æˆ‘å€‘å°±èƒ½é€éä¸Šé¢ `activeTodosCount` Getter çŸ¥é“æœ‰å¤šå°‘æœªå®Œæˆçš„ todosã€‚

ä½ å¯èƒ½æœƒç–‘æƒ‘ï¼Œç‚ºä»€éº¼æˆ‘å€‘ä¸ç›´æ¥å¯«å€‹åƒä¸‹é¢é€™æ¨£çš„ `activeTodos` çš„ Getterï¼Ÿ

```javascript
  activeTodosCount: (state) => {
    return state.todos.filter(todo => !todo.done).length
  }
```

å…¶å¯¦é€™æ¨£å¯«ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æˆ‘å€‘é‚£æ¨£å¯«æ˜¯ç‚ºäº†è¦å±•ç¤ºå¦‚ä½•åœ¨ Getter å‚³å…¥ `getters` ä¸¦ä¸”ä½¿ç”¨å®ƒã€‚

## å‹•æ…‹çš„ Getter

å­¸åˆ°ç¾åœ¨ï¼Œæˆ‘å€‘å¯èƒ½æœƒæƒ³æ˜¯ä¸æ˜¯æœ‰æ©Ÿæœƒå¯ä»¥ä½¿ç”¨å‹•æ…‹çš„ Getterã€‚æ›è¨€ä¹‹å°±æ˜¯å¯ä»¥åŸºæ–¼åƒæ•¸å–å¾—æŸå€‹ stateã€‚ç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œæˆ‘å€‘å¯ä»¥è—‰ç”±å›å‚³ä¸€å€‹å‡½å¼ä¾†é”æˆé€™å€‹ç›®çš„ã€‚

èˆ‰å€‹æ —å­ï¼Œå‡å¦‚æˆ‘å€‘æœ‰ä¸€å€‹æ´»å‹•é™£åˆ—ï¼Œæˆ‘å€‘å¯ä»¥åƒä¸‹é¢çš„ç¨‹å¼ç¢¼é€™æ¨£åˆ©ç”¨ `id` å–å¾—æ´»å‹•ï¼š

```javascript
  getEventById: (state) => (id) => {
    return state.events.find(event => event.id === id)
  }
```

æ¥è‘—åœ¨çµ„ä»¶çš„ `computed` å±¬æ€§è£¡é¢ï¼Œå°±å¯ä»¥é€™æ¨£å¯«ï¼š

```javascript
  computed: {
    getEvent() {
      return this.$store.getters.getEventById
    }
  }
```

åœ¨æ¨£æ¿è£¡é¢å°±å¯ä»¥å‚³éåƒæ•¸ä¾†å–å¾—ç‰¹å®šçš„æ´»å‹•ï¼š

```javascript
  <p>{{ getEvent(1) }}</p>
```

åœ¨é€™é‚Šè¦æ³¨æ„ä¸€ä¸‹ï¼Œåƒé€™æ¨£çš„å‹•æ…‹ Getter æ¯æ¬¡å‘¼å«éƒ½æœƒåŸ·è¡Œï¼Œè€Œä¸”çµæœæ˜¯ä¸æœƒè¢«å¿«å–ä½çš„ã€‚

## `mapGetters` å°å¹«æ‰‹

å’Œå­˜å– State çš„æ¦‚å¿µä¸€æ¨£ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥åœ¨çµ„ä»¶è£¡é¢æ­é… `mapGetters` å°å¹«æ‰‹æ˜ å°„ Getter åˆ° `computed` å±¬æ€§ã€‚

é¦–å…ˆæˆ‘å€‘è¦å…ˆæŠŠå®ƒ `import` é€²ä¾†ï¼š

```javascript
  import { mapGetters } from 'vuex'
```

ç„¶å¾Œå°±å¯ä»¥é€™æ¨£ç”¨ï¼š

```javascript
  computed: mapGetters([
    'categoriesLength',
    'getEventById'
  ])
```

é€™æ¨£å­åœ¨çµ„ä»¶ä¸­å°±æœ‰å€‹æ˜ å°„åˆ° Getter çš„ `computed` å±¬æ€§çš„é™£åˆ—ã€‚

å¦‚æœæƒ³è¦æ›´æ”¹ Getter çš„åå­—ï¼Œå¯ä»¥åƒä¸‹é¢é€™æ¨£ğŸ‘‡ï¼š

```javascript
  computed: mapGetters([
    catCount: 'categoriesLength',
    getEvent: 'getEventById'
  ])
```

é€™æ¨£å¯«çš„è©±ï¼Œ`this.catCount` æœƒæ˜ å°„åˆ° `this.$store.getters.categoriesLength` è€Œ `getEvent` æœƒæ˜ å°„åˆ° `this.$store.getters.getEventById`ã€‚

### ç‰©ä»¶å»¶å±•é‹ç®—å­(Object Spread Operator)

å’Œ `mapState` çš„æ¦‚å¿µç›¸åŒï¼Œå¦‚æœæƒ³è¦æ··åˆæœ¬åœ°çš„ `computed` å±¬æ€§ï¼Œæˆ– `mapState` å±¬æ€§æ™‚ï¼Œæˆ‘å€‘å°±éœ€è¦ç”¨åˆ°ç‰©ä»¶å»¶å±•é‹ç®—å­ã€‚

```javascript
  computed: {
    localComputed() { return something },
    ...mapGetters({
      catCount: 'categoriesLength',
      getEvent: 'getEventById'
    })
  }
```